"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[445],{9445:(J0,Be,_)=>{_.r(Be),_.d(Be,{GamesModule:()=>j0});var T=_(163),$=_(9804),I=_(7791),ie=_(8575),at=_(3887),ot=_(1829);function C(i,e){const t="object"==typeof e;return new Promise((n,a)=>{const o=new ot.Hp({next:s=>{n(s),o.unsubscribe()},error:a,complete:()=>{t?n(e.defaultValue):a(new at.K)}});i.subscribe(o)})}var ct=_(3149),r=_(7487);class Ne{constructor(e=!1,t,n=!0){this._multiple=e,this._emitChanges=n,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new ct.x,t&&t.length&&(e?t.forEach(a=>this._markSelected(a)):this._markSelected(t[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...e){this._verifyValueAssignment(e),e.forEach(t=>this._markSelected(t)),this._emitChangeEvent()}deselect(...e){this._verifyValueAssignment(e),e.forEach(t=>this._unmarkSelected(t)),this._emitChangeEvent()}toggle(e){this.isSelected(e)?this.deselect(e):this.select(e)}clear(){this._unmarkAll(),this._emitChangeEvent()}isSelected(e){return this._selection.has(e)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(e){this._multiple&&this.selected&&this._selected.sort(e)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(e){this.isSelected(e)||(this._multiple||this._unmarkAll(),this._selection.add(e),this._emitChanges&&this._selectedToEmit.push(e))}_unmarkSelected(e){this.isSelected(e)&&(this._selection.delete(e),this._emitChanges&&this._deselectedToEmit.push(e))}_unmarkAll(){this.isEmpty()||this._selection.forEach(e=>this._unmarkSelected(e))}_verifyValueAssignment(e){}}var E=_(1390);const $e=["A","B","C","D","E","F","G","H","I","J"],Ze=[1,2,3,4,5,6,7,8,9,10],F=10;var Z=(()=>{return(i=Z||(Z={})).Carrier="CA",i.Battleship="B",i.Cruiser="CR",i.Submarine="S",i.Destroyer="D",Z;var i})();const Se=[{id:Z.Carrier,name:"Carrier",length:5},{id:Z.Battleship,name:"Battleship",length:4},{id:Z.Cruiser,name:"Cruiser",length:3},{id:Z.Submarine,name:"Submarine",length:3},{id:Z.Destroyer,name:"Destroyer",length:2}];function lt(i,e){if(1&i&&(r.TgZ(0,"th"),r._uU(1),r.qZA()),2&i){const t=e.$implicit;r.xp6(1),r.Oqu(t)}}function dt(i,e){if(1&i&&(r.TgZ(0,"td",11)(1,"span"),r._uU(2),r.qZA()()),2&i){const t=e.ngIf;r.xp6(2),r.Oqu(t.id)}}function ut(i,e){if(1&i){const t=r.EpF();r.TgZ(0,"td",12),r.NdJ("click",function(){r.CHM(t);const a=r.oxw().index,o=r.oxw().index;return r.oxw().placeSelectedShip(a,o)}),r.qZA()}}function ft(i,e){if(1&i&&(r.ynx(0),r.YNc(1,dt,3,1,"td",9),r.YNc(2,ut,1,0,"ng-template",null,10,r.W1O),r.BQk()),2&i){const t=e.index,n=r.MAs(3),a=r.oxw().index,o=r.oxw();r.xp6(1),r.Q6J("ngIf",o.occupancyBoard[t][a])("ngIfElse",n)}}function pt(i,e){if(1&i&&(r.TgZ(0,"tr")(1,"th"),r._uU(2),r.qZA(),r.YNc(3,ft,4,2,"ng-container",2),r.qZA()),2&i){const t=e.$implicit,n=r.oxw();r.xp6(2),r.Oqu(t),r.xp6(1),r.Q6J("ngForOf",n.columns)}}function ht(i,e){1&i&&(r.TgZ(0,"span",15),r._uU(1,"\u2713"),r.qZA())}function bt(i,e){if(1&i){const t=r.EpF();r.TgZ(0,"li",13),r.NdJ("click",function(){const o=r.CHM(t).$implicit;return r.oxw().shipSelection.toggle(o)}),r._uU(1),r.YNc(2,ht,2,0,"span",14),r.qZA()}if(2&i){const t=e.$implicit,n=r.oxw();r.ekj("active",n.shipSelection.isSelected(t)),r.xp6(1),r.lnq(" ",t.name," (",t.id," - ",t.length,") "),r.xp6(1),r.Q6J("ngIf",n.hasPlacedShip(t))}}let se=(()=>{class i{constructor(){this.ShipType=Z,this.ships=Se,this.columns=$e,this.rows=Ze,this.fleetConfiguration$=new ie.X([void 0,void 0,void 0,void 0,void 0]),this.fleetComplete$=this.fleetConfiguration$.pipe((0,E.U)(t=>t.every(n=>!!n))),this.shipSelection=new Ne,this.placeShipsHorizontally=!0,this.occupancyBoard=[];for(let t=0;t<F;t++)this.occupancyBoard.push(new Array(F).fill(void 0))}ngOnInit(){}placeSelectedShip(t,n){const a=this.shipSelection.selected[0];this.shipPlacementOnBoardInvalid(a,t,n)||(this.removeShipFromBoard(a),this.placeShip(a,t,n),this.shipSelection.clear())}toggleShipPlacementOrientation(){this.placeShipsHorizontally=!this.placeShipsHorizontally}hasPlacedShip(t){const n=this.ships.indexOf(t);return!!this.fleetConfiguration$.value[n]}shipPlacementOnBoardInvalid(t,n,a){const o=(this.placeShipsHorizontally?n:a)+t.length-1;if(o>=F)return!0;if(this.placeShipsHorizontally){for(let s=n;s<o+1;s++)if(void 0!==this.occupancyBoard[s][a]&&this.occupancyBoard[s][a]!==t)return!0}else for(let s=a;s<o+1;s++)if(void 0!==this.occupancyBoard[n][s]&&this.occupancyBoard[n][s]!==t)return!0;return!1}placeShip(t,n,a){const o=this.ships.indexOf(t),s=this.fleetConfiguration$.value;if(s[o]=[BigInt(n),BigInt(a),this.placeShipsHorizontally?BigInt(0):BigInt(1)],this.fleetConfiguration$.next(s),this.placeShipsHorizontally)for(let c=n;c<n+t.length;c++)this.occupancyBoard[c][a]=t;else for(let c=a;c<a+t.length;c++)this.occupancyBoard[n][c]=t}removeShipFromBoard(t){const n=this.ships.indexOf(t),a=this.fleetConfiguration$.value;a[n]=void 0,this.fleetConfiguration$.next(a);for(let o=0;o<F;o++)for(let s=0;s<F;s++)this.occupancyBoard[o][s]===t&&(this.occupancyBoard[o][s]=void 0)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-fleet-setup-board"]],decls:14,vars:4,consts:[[1,"d-flex","justify-content-center"],[1,"flex-2","m-5"],[4,"ngFor","ngForOf"],[1,"card","border-primary","flex-1","m-5",2,"max-width","20rem"],[1,"card-header"],[1,"list-group","list-group-flush"],["class","list-group-item list-group-item-action d-flex justify-content-between align-items-center",3,"active","click",4,"ngFor","ngForOf"],[1,"card-body"],[1,"btn","btn-outline-primary",3,"click"],["class","ship-present",4,"ngIf","ngIfElse"],["noShipCell",""],[1,"ship-present"],[3,"click"],[1,"list-group-item","list-group-item-action","d-flex","justify-content-between","align-items-center",3,"click"],["class","badge bg-secondary",4,"ngIf"],[1,"badge","bg-secondary"]],template:function(t,n){1&t&&(r.TgZ(0,"div",0)(1,"table",1)(2,"tr"),r._UZ(3,"th"),r.YNc(4,lt,2,1,"th",2),r.qZA(),r.YNc(5,pt,4,2,"tr",2),r.qZA(),r.TgZ(6,"div",3)(7,"h2",4),r._uU(8,"Your Fleet"),r.qZA(),r.TgZ(9,"ul",5),r.YNc(10,bt,3,6,"li",6),r.qZA(),r.TgZ(11,"div",7)(12,"button",8),r.NdJ("click",function(){return n.toggleShipPlacementOrientation()}),r._uU(13),r.qZA()()()()),2&t&&(r.xp6(4),r.Q6J("ngForOf",n.columns),r.xp6(1),r.Q6J("ngForOf",n.rows),r.xp6(5),r.Q6J("ngForOf",n.ships),r.xp6(3),r.hij(" ship orientation: ",n.placeShipsHorizontally?"horizontal":"vertical"," "))},directives:[T.sg,T.O5],styles:["th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{width:48px;height:48px;text-align:center}td[_ngcontent-%COMP%]{border:1px solid #1a1a1a}td[_ngcontent-%COMP%]:hover{background-color:#eceeef}.card[_ngcontent-%COMP%]{margin-top:calc(3rem + 48px)!important}"]}),i})();function ze(){return BigInt(Math.floor(Math.random()*10**8))}var ae=_(1899);const oe="assets/circuits";let Te=(()=>{class i{constructor(t){this.snarkjs=t.defaultView.snarkjs}generateBoardSetupProof(t,n){var a=this;return(0,I.Z)(function*(){const{proof:o,publicSignals:s}=yield a.snarkjs.groth16.fullProve({ships:t,trapdoor:n},`${oe}/boardsetup/boardsetup.wasm`,`${oe}/boardsetup/boardsetup_final.zkey`);return{...a.parseGroth16Proof(o),boardHash:BigInt(s[0])}})()}generateFireShotProof(t,n,a,o){var s=this;return(0,I.Z)(function*(){const{proof:c,publicSignals:d}=yield s.snarkjs.groth16.fullProve({ships:t,trapdoor:n,hash:a,shotIndex:o},`${oe}/fireshot/fireshot.wasm`,`${oe}/fireshot/fireshot_final.zkey`);return{...s.parseGroth16Proof(c),hitShipId:BigInt(d[0])}})()}parseGroth16Proof({pi_a:t,pi_b:n,pi_c:a}){return{pi_a:[BigInt(t[0]),BigInt(t[1])],pi_b:[[BigInt(n[0][1]),BigInt(n[0][0])],[BigInt(n[1][1]),BigInt(n[1][0])]],pi_c:[BigInt(a[0]),BigInt(a[1])]}}}return i.\u0275fac=function(t){return new(t||i)(r.LFG(T.K0))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var v=_(8781),p=_(469),G=_(7498),u=_(2339),b=_(3615);const H="abi/5.6.1",Ee=new b.Yd(H);class M{constructor(e,t,n,a){this.name=e,this.type=t,this.localName=n,this.dynamic=a}_throwError(e,t){Ee.throwArgumentError(e,this.localName,t)}}class xe{constructor(e){(0,u.zG)(this,"wordSize",e||32),this._data=[],this._dataLength=0,this._padding=new Uint8Array(e)}get data(){return(0,p.xs)(this._data)}get length(){return this._dataLength}_writeData(e){return this._data.push(e),this._dataLength+=e.length,e.length}appendWriter(e){return this._writeData((0,p.zo)(e._data))}writeBytes(e){let t=(0,p.lE)(e);const n=t.length%this.wordSize;return n&&(t=(0,p.zo)([t,this._padding.slice(n)])),this._writeData(t)}_getValue(e){let t=(0,p.lE)(G.O$.from(e));return t.length>this.wordSize&&Ee.throwError("value out-of-bounds",b.Yd.errors.BUFFER_OVERRUN,{length:this.wordSize,offset:t.length}),t.length%this.wordSize&&(t=(0,p.zo)([this._padding.slice(t.length%this.wordSize),t])),t}writeValue(e){return this._writeData(this._getValue(e))}writeUpdatableValue(){const e=this._data.length;return this._data.push(this._padding),this._dataLength+=this.wordSize,t=>{this._data[e]=this._getValue(t)}}}class ce{constructor(e,t,n,a){(0,u.zG)(this,"_data",(0,p.lE)(e)),(0,u.zG)(this,"wordSize",t||32),(0,u.zG)(this,"_coerceFunc",n),(0,u.zG)(this,"allowLoose",a),this._offset=0}get data(){return(0,p.Dv)(this._data)}get consumed(){return this._offset}static coerce(e,t){let n=e.match("^u?int([0-9]+)$");return n&&parseInt(n[1])<=48&&(t=t.toNumber()),t}coerce(e,t){return this._coerceFunc?this._coerceFunc(e,t):ce.coerce(e,t)}_peekBytes(e,t,n){let a=Math.ceil(t/this.wordSize)*this.wordSize;return this._offset+a>this._data.length&&(this.allowLoose&&n&&this._offset+t<=this._data.length?a=t:Ee.throwError("data out-of-bounds",b.Yd.errors.BUFFER_OVERRUN,{length:this._data.length,offset:this._offset+a})),this._data.slice(this._offset,this._offset+a)}subReader(e){return new ce(this._data.slice(this._offset+e),this.wordSize,this._coerceFunc,this.allowLoose)}readBytes(e,t){let n=this._peekBytes(0,e,!!t);return this._offset+=n.length,n.slice(0,e)}readValue(){return G.O$.from(this.readBytes(this.wordSize))}}var R=_(3781),le=_(9167),Ue=_(2640);class yt extends M{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){try{t=(0,R.Kn)(t)}catch(n){this._throwError(n.message,t)}return e.writeValue(t)}decode(e){return(0,R.Kn)((0,p.$m)(e.readValue().toHexString(),20))}}class gt extends M{constructor(e){super(e.name,e.type,void 0,e.dynamic),this.coder=e}defaultValue(){return this.coder.defaultValue()}encode(e,t){return this.coder.encode(e,t)}decode(e){return this.coder.decode(e)}}const k=new b.Yd(H);function Fe(i,e,t){let n=null;if(Array.isArray(t))n=t;else if(t&&"object"==typeof t){let d={};n=e.map(l=>{const f=l.localName;return f||k.throwError("cannot encode object for signature with missing names",b.Yd.errors.INVALID_ARGUMENT,{argument:"values",coder:l,value:t}),d[f]&&k.throwError("cannot encode object for signature with duplicate names",b.Yd.errors.INVALID_ARGUMENT,{argument:"values",coder:l,value:t}),d[f]=!0,t[f]})}else k.throwArgumentError("invalid tuple value","tuple",t);e.length!==n.length&&k.throwArgumentError("types/value length mismatch","tuple",t);let a=new xe(i.wordSize),o=new xe(i.wordSize),s=[];e.forEach((d,l)=>{let f=n[l];if(d.dynamic){let h=o.length;d.encode(o,f);let g=a.writeUpdatableValue();s.push(A=>{g(A+h)})}else d.encode(a,f)}),s.forEach(d=>{d(a.length)});let c=i.appendWriter(a);return c+=i.appendWriter(o),c}function Re(i,e){let t=[],n=i.subReader(0);e.forEach(o=>{let s=null;if(o.dynamic){let c=i.readValue(),d=n.subReader(c.toNumber());try{s=o.decode(d)}catch(l){if(l.code===b.Yd.errors.BUFFER_OVERRUN)throw l;s=l,s.baseType=o.name,s.name=o.localName,s.type=o.type}}else try{s=o.decode(i)}catch(c){if(c.code===b.Yd.errors.BUFFER_OVERRUN)throw c;s=c,s.baseType=o.name,s.name=o.localName,s.type=o.type}null!=s&&t.push(s)});const a=e.reduce((o,s)=>{const c=s.localName;return c&&(o[c]||(o[c]=0),o[c]++),o},{});e.forEach((o,s)=>{let c=o.localName;if(!c||1!==a[c]||("length"===c&&(c="_length"),null!=t[c]))return;const d=t[s];d instanceof Error?Object.defineProperty(t,c,{enumerable:!0,get:()=>{throw d}}):t[c]=d});for(let o=0;o<t.length;o++){const s=t[o];s instanceof Error&&Object.defineProperty(t,o,{enumerable:!0,get:()=>{throw s}})}return Object.freeze(t)}class _t extends M{constructor(e,t,n){super("array",e.type+"["+(t>=0?t:"")+"]",n,-1===t||e.dynamic),this.coder=e,this.length=t}defaultValue(){const e=this.coder.defaultValue(),t=[];for(let n=0;n<this.length;n++)t.push(e);return t}encode(e,t){Array.isArray(t)||this._throwError("expected array value",t);let n=this.length;-1===n&&(n=t.length,e.writeValue(t.length)),k.checkArgumentCount(t.length,n,"coder array"+(this.localName?" "+this.localName:""));let a=[];for(let o=0;o<t.length;o++)a.push(this.coder);return Fe(e,a,t)}decode(e){let t=this.length;-1===t&&(t=e.readValue().toNumber(),32*t>e._data.length&&k.throwError("insufficient data length",b.Yd.errors.BUFFER_OVERRUN,{length:e._data.length,count:t}));let n=[];for(let a=0;a<t;a++)n.push(new gt(this.coder));return e.coerce(this.name,Re(e,n))}}class wt extends M{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){return e.writeValue(t?1:0)}decode(e){return e.coerce(this.type,!e.readValue().isZero())}}class Le extends M{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=(0,p.lE)(t);let n=e.writeValue(t.length);return n+=e.writeBytes(t),n}decode(e){return e.readBytes(e.readValue().toNumber(),!0)}}class St extends Le{constructor(e){super("bytes",e)}decode(e){return e.coerce(this.name,(0,p.Dv)(super.decode(e)))}}class Tt extends M{constructor(e,t){let n="bytes"+String(e);super(n,n,t,!1),this.size=e}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+2*this.size)}encode(e,t){let n=(0,p.lE)(t);return n.length!==this.size&&this._throwError("incorrect data length",t),e.writeBytes(n)}decode(e){return e.coerce(this.name,(0,p.Dv)(e.readBytes(this.size)))}}class Et extends M{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return null!=t&&this._throwError("not null",t),e.writeBytes([])}decode(e){return e.readBytes(0),e.coerce(this.name,null)}}var de=_(1865);class xt extends M{constructor(e,t,n){const a=(t?"int":"uint")+8*e;super(a,a,n,!1),this.size=e,this.signed=t}defaultValue(){return 0}encode(e,t){let n=G.O$.from(t),a=de.Bz.mask(8*e.wordSize);if(this.signed){let o=a.mask(8*this.size-1);(n.gt(o)||n.lt(o.add(de.fh).mul(de.tL)))&&this._throwError("value out-of-bounds",t)}else(n.lt(de._Y)||n.gt(a.mask(8*this.size)))&&this._throwError("value out-of-bounds",t);return n=n.toTwos(8*this.size).mask(8*this.size),this.signed&&(n=n.fromTwos(8*this.size).toTwos(8*e.wordSize)),e.writeValue(n)}decode(e){let t=e.readValue().mask(8*this.size);return this.signed&&(t=t.fromTwos(8*this.size)),e.coerce(this.name,t)}}var De=_(9089);class vt extends Le{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,(0,De.Y0)(t))}decode(e){return(0,De.ZN)(super.decode(e))}}class ue extends M{constructor(e,t){let n=!1;const a=[];e.forEach(s=>{s.dynamic&&(n=!0),a.push(s.type)}),super("tuple","tuple("+a.join(",")+")",t,n),this.coders=e}defaultValue(){const e=[];this.coders.forEach(n=>{e.push(n.defaultValue())});const t=this.coders.reduce((n,a)=>{const o=a.localName;return o&&(n[o]||(n[o]=0),n[o]++),n},{});return this.coders.forEach((n,a)=>{let o=n.localName;!o||1!==t[o]||("length"===o&&(o="_length"),null==e[o]&&(e[o]=e[a]))}),Object.freeze(e)}encode(e,t){return Fe(e,this.coders,t)}decode(e){return e.coerce(this.name,Re(e,this.coders))}}const m=new b.Yd(H),j={};let je={calldata:!0,memory:!0,storage:!0},Ct={calldata:!0,memory:!0};function fe(i,e){if("bytes"===i||"string"===i){if(je[e])return!0}else if("address"===i){if("payable"===e)return!0}else if((i.indexOf("[")>=0||"tuple"===i)&&Ct[e])return!0;return(je[e]||"payable"===e)&&m.throwArgumentError("invalid modifier","name",e),!1}function pe(i,e){for(let t in e)(0,u.zG)(i,t,e[t])}const y=Object.freeze({sighash:"sighash",minimal:"minimal",full:"full",json:"json"}),Gt=new RegExp(/^(.*)\[([0-9]*)\]$/);class x{constructor(e,t){e!==j&&m.throwError("use fromString",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new ParamType()"}),pe(this,t);let n=this.type.match(Gt);pe(this,n?{arrayLength:parseInt(n[2]||"-1"),arrayChildren:x.fromObject({type:n[1],components:this.components}),baseType:"array"}:{arrayLength:null,arrayChildren:null,baseType:null!=this.components?"tuple":this.type}),this._isParamType=!0,Object.freeze(this)}format(e){if(e||(e=y.sighash),y[e]||m.throwArgumentError("invalid format type","format",e),e===y.json){let n={type:"tuple"===this.baseType?"tuple":this.type,name:this.name||void 0};return"boolean"==typeof this.indexed&&(n.indexed=this.indexed),this.components&&(n.components=this.components.map(a=>JSON.parse(a.format(e)))),JSON.stringify(n)}let t="";return"array"===this.baseType?(t+=this.arrayChildren.format(e),t+="["+(this.arrayLength<0?"":String(this.arrayLength))+"]"):"tuple"===this.baseType?(e!==y.sighash&&(t+=this.type),t+="("+this.components.map(n=>n.format(e)).join(e===y.full?", ":",")+")"):t+=this.type,e!==y.sighash&&(!0===this.indexed&&(t+=" indexed"),e===y.full&&this.name&&(t+=" "+this.name)),t}static from(e,t){return"string"==typeof e?x.fromString(e,t):x.fromObject(e)}static fromObject(e){return x.isParamType(e)?e:new x(j,{name:e.name||null,type:V(e.type),indexed:null==e.indexed?null:!!e.indexed,components:e.components?e.components.map(x.fromObject):null})}static fromString(e,t){return function n(a){return x.fromObject({name:a.name,type:a.type,indexed:a.indexed,components:a.components})}(function At(i,e){let t=i;function n(c){m.throwArgumentError(`unexpected character at position ${c}`,"param",i)}function a(c){let d={type:"",name:"",parent:c,state:{allowType:!0}};return e&&(d.indexed=!1),d}i=i.replace(/\s/g," ");let o={type:"",name:"",state:{allowType:!0}},s=o;for(let c=0;c<i.length;c++){let d=i[c];switch(d){case"(":s.state.allowType&&""===s.type?s.type="tuple":s.state.allowParams||n(c),s.state.allowType=!1,s.type=V(s.type),s.components=[a(s)],s=s.components[0];break;case")":delete s.state,"indexed"===s.name&&(e||n(c),s.indexed=!0,s.name=""),fe(s.type,s.name)&&(s.name=""),s.type=V(s.type);let l=s;s=s.parent,s||n(c),delete l.parent,s.state.allowParams=!1,s.state.allowName=!0,s.state.allowArray=!0;break;case",":delete s.state,"indexed"===s.name&&(e||n(c),s.indexed=!0,s.name=""),fe(s.type,s.name)&&(s.name=""),s.type=V(s.type);let f=a(s.parent);s.parent.components.push(f),delete s.parent,s=f;break;case" ":s.state.allowType&&""!==s.type&&(s.type=V(s.type),delete s.state.allowType,s.state.allowName=!0,s.state.allowParams=!0),s.state.allowName&&""!==s.name&&("indexed"===s.name?(e||n(c),s.indexed&&n(c),s.indexed=!0,s.name=""):fe(s.type,s.name)?s.name="":s.state.allowName=!1);break;case"[":s.state.allowArray||n(c),s.type+=d,s.state.allowArray=!1,s.state.allowName=!1,s.state.readArray=!0;break;case"]":s.state.readArray||n(c),s.type+=d,s.state.readArray=!1,s.state.allowArray=!0,s.state.allowName=!0;break;default:s.state.allowType?(s.type+=d,s.state.allowParams=!0,s.state.allowArray=!0):s.state.allowName?(s.name+=d,delete s.state.allowArray):s.state.readArray?s.type+=d:n(c)}}return s.parent&&m.throwArgumentError("unexpected eof","param",i),delete o.state,"indexed"===s.name?(e||n(t.length-7),s.indexed&&n(t.length-7),s.indexed=!0,s.name=""):fe(s.type,s.name)&&(s.name=""),o.type=V(o.type),o}(e,!!t))}static isParamType(e){return!(null==e||!e._isParamType)}}function W(i,e){return function Ot(i){i=i.trim();let e=[],t="",n=0;for(let a=0;a<i.length;a++){let o=i[a];","===o&&0===n?(e.push(t),t=""):(t+=o,"("===o?n++:")"===o&&(n--,-1===n&&m.throwArgumentError("unbalanced parenthesis","value",i)))}return t&&e.push(t),e}(i).map(t=>x.fromString(t,e))}class z{constructor(e,t){e!==j&&m.throwError("use a static from method",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new Fragment()"}),pe(this,t),this._isFragment=!0,Object.freeze(this)}static from(e){return z.isFragment(e)?e:"string"==typeof e?z.fromString(e):z.fromObject(e)}static fromObject(e){if(z.isFragment(e))return e;switch(e.type){case"function":return B.fromObject(e);case"event":return U.fromObject(e);case"constructor":return P.fromObject(e);case"error":return L.fromObject(e);case"fallback":case"receive":return null}return m.throwArgumentError("invalid fragment object","value",e)}static fromString(e){return"event"===(e=(e=(e=e.replace(/\s/g," ")).replace(/\(/g," (").replace(/\)/g,") ").replace(/\s+/g," ")).trim()).split(" ")[0]?U.fromString(e.substring(5).trim()):"function"===e.split(" ")[0]?B.fromString(e.substring(8).trim()):"constructor"===e.split("(")[0].trim()?P.fromString(e.trim()):"error"===e.split(" ")[0]?L.fromString(e.substring(5).trim()):m.throwArgumentError("unsupported fragment","value",e)}static isFragment(e){return!(!e||!e._isFragment)}}class U extends z{format(e){if(e||(e=y.sighash),y[e]||m.throwArgumentError("invalid format type","format",e),e===y.json)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});let t="";return e!==y.sighash&&(t+="event "),t+=this.name+"("+this.inputs.map(n=>n.format(e)).join(e===y.full?", ":",")+") ",e!==y.sighash&&this.anonymous&&(t+="anonymous "),t.trim()}static from(e){return"string"==typeof e?U.fromString(e):U.fromObject(e)}static fromObject(e){if(U.isEventFragment(e))return e;"event"!==e.type&&m.throwArgumentError("invalid event object","value",e);const t={name:X(e.name),anonymous:e.anonymous,inputs:e.inputs?e.inputs.map(x.fromObject):[],type:"event"};return new U(j,t)}static fromString(e){let t=e.match(K);t||m.throwArgumentError("invalid event string","value",e);let n=!1;return t[3].split(" ").forEach(a=>{switch(a.trim()){case"anonymous":n=!0;break;case"":break;default:m.warn("unknown modifier: "+a)}}),U.fromObject({name:t[1].trim(),anonymous:n,inputs:W(t[2],!0),type:"event"})}static isEventFragment(e){return e&&e._isFragment&&"event"===e.type}}function ke(i,e){e.gas=null;let t=i.split("@");return 1!==t.length?(t.length>2&&m.throwArgumentError("invalid human-readable ABI signature","value",i),t[1].match(/^[0-9]+$/)||m.throwArgumentError("invalid human-readable ABI signature gas","value",i),e.gas=G.O$.from(t[1]),t[0]):i}function Ve(i,e){e.constant=!1,e.payable=!1,e.stateMutability="nonpayable",i.split(" ").forEach(t=>{switch(t.trim()){case"constant":e.constant=!0;break;case"payable":e.payable=!0,e.stateMutability="payable";break;case"nonpayable":e.payable=!1,e.stateMutability="nonpayable";break;case"pure":e.constant=!0,e.stateMutability="pure";break;case"view":e.constant=!0,e.stateMutability="view";break;case"external":case"public":case"":break;default:console.log("unknown modifier: "+t)}})}function Ye(i){let e={constant:!1,payable:!0,stateMutability:"payable"};return null!=i.stateMutability?(e.stateMutability=i.stateMutability,e.constant="view"===e.stateMutability||"pure"===e.stateMutability,null!=i.constant&&!!i.constant!==e.constant&&m.throwArgumentError("cannot have constant function with mutability "+e.stateMutability,"value",i),e.payable="payable"===e.stateMutability,null!=i.payable&&!!i.payable!==e.payable&&m.throwArgumentError("cannot have payable function with mutability "+e.stateMutability,"value",i)):null!=i.payable?(e.payable=!!i.payable,null==i.constant&&!e.payable&&"constructor"!==i.type&&m.throwArgumentError("unable to determine stateMutability","value",i),e.constant=!!i.constant,e.stateMutability=e.constant?"view":e.payable?"payable":"nonpayable",e.payable&&e.constant&&m.throwArgumentError("cannot have constant payable function","value",i)):null!=i.constant?(e.constant=!!i.constant,e.payable=!e.constant,e.stateMutability=e.constant?"view":"payable"):"constructor"!==i.type&&m.throwArgumentError("unable to determine stateMutability","value",i),e}class P extends z{format(e){if(e||(e=y.sighash),y[e]||m.throwArgumentError("invalid format type","format",e),e===y.json)return JSON.stringify({type:"constructor",stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});e===y.sighash&&m.throwError("cannot format a constructor for sighash",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"format(sighash)"});let t="constructor("+this.inputs.map(n=>n.format(e)).join(e===y.full?", ":",")+") ";return this.stateMutability&&"nonpayable"!==this.stateMutability&&(t+=this.stateMutability+" "),t.trim()}static from(e){return"string"==typeof e?P.fromString(e):P.fromObject(e)}static fromObject(e){if(P.isConstructorFragment(e))return e;"constructor"!==e.type&&m.throwArgumentError("invalid constructor object","value",e);let t=Ye(e);t.constant&&m.throwArgumentError("constructor cannot be constant","value",e);const n={name:null,type:e.type,inputs:e.inputs?e.inputs.map(x.fromObject):[],payable:t.payable,stateMutability:t.stateMutability,gas:e.gas?G.O$.from(e.gas):null};return new P(j,n)}static fromString(e){let t={type:"constructor"},n=(e=ke(e,t)).match(K);return(!n||"constructor"!==n[1].trim())&&m.throwArgumentError("invalid constructor string","value",e),t.inputs=W(n[2].trim(),!1),Ve(n[3].trim(),t),P.fromObject(t)}static isConstructorFragment(e){return e&&e._isFragment&&"constructor"===e.type}}class B extends P{format(e){if(e||(e=y.sighash),y[e]||m.throwArgumentError("invalid format type","format",e),e===y.json)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(e))),outputs:this.outputs.map(n=>JSON.parse(n.format(e)))});let t="";return e!==y.sighash&&(t+="function "),t+=this.name+"("+this.inputs.map(n=>n.format(e)).join(e===y.full?", ":",")+") ",e!==y.sighash&&(this.stateMutability?"nonpayable"!==this.stateMutability&&(t+=this.stateMutability+" "):this.constant&&(t+="view "),this.outputs&&this.outputs.length&&(t+="returns ("+this.outputs.map(n=>n.format(e)).join(", ")+") "),null!=this.gas&&(t+="@"+this.gas.toString()+" ")),t.trim()}static from(e){return"string"==typeof e?B.fromString(e):B.fromObject(e)}static fromObject(e){if(B.isFunctionFragment(e))return e;"function"!==e.type&&m.throwArgumentError("invalid function object","value",e);let t=Ye(e);const n={type:e.type,name:X(e.name),constant:t.constant,inputs:e.inputs?e.inputs.map(x.fromObject):[],outputs:e.outputs?e.outputs.map(x.fromObject):[],payable:t.payable,stateMutability:t.stateMutability,gas:e.gas?G.O$.from(e.gas):null};return new B(j,n)}static fromString(e){let t={type:"function"},n=(e=ke(e,t)).split(" returns ");n.length>2&&m.throwArgumentError("invalid function string","value",e);let a=n[0].match(K);if(a||m.throwArgumentError("invalid function signature","value",e),t.name=a[1].trim(),t.name&&X(t.name),t.inputs=W(a[2],!1),Ve(a[3].trim(),t),n.length>1){let o=n[1].match(K);(""!=o[1].trim()||""!=o[3].trim())&&m.throwArgumentError("unexpected tokens","value",e),t.outputs=W(o[2],!1)}else t.outputs=[];return B.fromObject(t)}static isFunctionFragment(e){return e&&e._isFragment&&"function"===e.type}}function Je(i){const e=i.format();return("Error(string)"===e||"Panic(uint256)"===e)&&m.throwArgumentError(`cannot specify user defined ${e} error`,"fragment",i),i}class L extends z{format(e){if(e||(e=y.sighash),y[e]||m.throwArgumentError("invalid format type","format",e),e===y.json)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});let t="";return e!==y.sighash&&(t+="error "),t+=this.name+"("+this.inputs.map(n=>n.format(e)).join(e===y.full?", ":",")+") ",t.trim()}static from(e){return"string"==typeof e?L.fromString(e):L.fromObject(e)}static fromObject(e){if(L.isErrorFragment(e))return e;"error"!==e.type&&m.throwArgumentError("invalid error object","value",e);const t={type:e.type,name:X(e.name),inputs:e.inputs?e.inputs.map(x.fromObject):[]};return Je(new L(j,t))}static fromString(e){let t={type:"error"},n=e.match(K);return n||m.throwArgumentError("invalid error signature","value",e),t.name=n[1].trim(),t.name&&X(t.name),t.inputs=W(n[2],!1),Je(L.fromObject(t))}static isErrorFragment(e){return e&&e._isFragment&&"error"===e.type}}function V(i){return i.match(/^uint($|[^1-9])/)?i="uint256"+i.substring(4):i.match(/^int($|[^1-9])/)&&(i="int256"+i.substring(3)),i}const It=new RegExp("^[a-zA-Z$_][a-zA-Z0-9$_]*$");function X(i){return(!i||!i.match(It))&&m.throwArgumentError(`invalid identifier "${i}"`,"value",i),i}const K=new RegExp("^([^)(]*)\\((.*)\\)([^)(]*)$"),ee=new b.Yd(H),Pt=new RegExp(/^bytes([0-9]*)$/),Bt=new RegExp(/^(u?int)([0-9]*)$/);class ve{constructor(e){ee.checkNew(new.target,ve),(0,u.zG)(this,"coerceFunc",e||null)}_getCoder(e){switch(e.baseType){case"address":return new yt(e.name);case"bool":return new wt(e.name);case"string":return new vt(e.name);case"bytes":return new St(e.name);case"array":return new _t(this._getCoder(e.arrayChildren),e.arrayLength,e.name);case"tuple":return new ue((e.components||[]).map(n=>this._getCoder(n)),e.name);case"":return new Et(e.name)}let t=e.type.match(Bt);if(t){let n=parseInt(t[2]||"256");return(0===n||n>256||n%8!=0)&&ee.throwArgumentError("invalid "+t[1]+" bit length","param",e),new xt(n/8,"int"===t[1],e.name)}if(t=e.type.match(Pt),t){let n=parseInt(t[1]);return(0===n||n>32)&&ee.throwArgumentError("invalid bytes length","param",e),new Tt(n,e.name)}return ee.throwArgumentError("invalid type","type",e.type)}_getWordSize(){return 32}_getReader(e,t){return new ce(e,this._getWordSize(),this.coerceFunc,t)}_getWriter(){return new xe(this._getWordSize())}getDefaultValue(e){const t=e.map(a=>this._getCoder(x.from(a)));return new ue(t,"_").defaultValue()}encode(e,t){e.length!==t.length&&ee.throwError("types/values length mismatch",b.Yd.errors.INVALID_ARGUMENT,{count:{types:e.length,values:t.length},value:{types:e,values:t}});const n=e.map(s=>this._getCoder(x.from(s))),a=new ue(n,"_"),o=this._getWriter();return a.encode(o,t),o.data}decode(e,t,n){const a=e.map(s=>this._getCoder(x.from(s)));return new ue(a,"_").decode(this._getReader((0,p.lE)(t),n))}}const Nt=new ve,S=new b.Yd(H);class $t extends u.dk{}class Zt extends u.dk{}class Mt extends u.dk{}class Ce extends u.dk{static isIndexed(e){return!(!e||!e._isIndexed)}}const zt={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:!0},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"]}};function qe(i,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${i}`);return t.error=e,t}class te{constructor(e){S.checkNew(new.target,te);let t=[];t="string"==typeof e?JSON.parse(e):e,(0,u.zG)(this,"fragments",t.map(n=>z.from(n)).filter(n=>null!=n)),(0,u.zG)(this,"_abiCoder",(0,u.tu)(new.target,"getAbiCoder")()),(0,u.zG)(this,"functions",{}),(0,u.zG)(this,"errors",{}),(0,u.zG)(this,"events",{}),(0,u.zG)(this,"structs",{}),this.fragments.forEach(n=>{let a=null;switch(n.type){case"constructor":return this.deploy?void S.warn("duplicate definition - constructor"):void(0,u.zG)(this,"deploy",n);case"function":a=this.functions;break;case"event":a=this.events;break;case"error":a=this.errors;break;default:return}let o=n.format();a[o]?S.warn("duplicate definition - "+o):a[o]=n}),this.deploy||(0,u.zG)(this,"deploy",P.from({payable:!1,type:"constructor"})),(0,u.zG)(this,"_isInterface",!0)}format(e){e||(e=y.full),e===y.sighash&&S.throwArgumentError("interface does not support formatting sighash","format",e);const t=this.fragments.map(n=>n.format(e));return e===y.json?JSON.stringify(t.map(n=>JSON.parse(n))):t}static getAbiCoder(){return Nt}static getAddress(e){return(0,R.Kn)(e)}static getSighash(e){return(0,p.p3)((0,le.id)(e.format()),0,4)}static getEventTopic(e){return(0,le.id)(e.format())}getFunction(e){if((0,p.A7)(e)){for(const n in this.functions)if(e===this.getSighash(n))return this.functions[n];S.throwArgumentError("no matching function","sighash",e)}if(-1===e.indexOf("(")){const n=e.trim(),a=Object.keys(this.functions).filter(o=>o.split("(")[0]===n);return 0===a.length?S.throwArgumentError("no matching function","name",n):a.length>1&&S.throwArgumentError("multiple matching functions","name",n),this.functions[a[0]]}const t=this.functions[B.fromString(e).format()];return t||S.throwArgumentError("no matching function","signature",e),t}getEvent(e){if((0,p.A7)(e)){const n=e.toLowerCase();for(const a in this.events)if(n===this.getEventTopic(a))return this.events[a];S.throwArgumentError("no matching event","topichash",n)}if(-1===e.indexOf("(")){const n=e.trim(),a=Object.keys(this.events).filter(o=>o.split("(")[0]===n);return 0===a.length?S.throwArgumentError("no matching event","name",n):a.length>1&&S.throwArgumentError("multiple matching events","name",n),this.events[a[0]]}const t=this.events[U.fromString(e).format()];return t||S.throwArgumentError("no matching event","signature",e),t}getError(e){if((0,p.A7)(e)){const n=(0,u.tu)(this.constructor,"getSighash");for(const a in this.errors)if(e===n(this.errors[a]))return this.errors[a];S.throwArgumentError("no matching error","sighash",e)}if(-1===e.indexOf("(")){const n=e.trim(),a=Object.keys(this.errors).filter(o=>o.split("(")[0]===n);return 0===a.length?S.throwArgumentError("no matching error","name",n):a.length>1&&S.throwArgumentError("multiple matching errors","name",n),this.errors[a[0]]}const t=this.errors[B.fromString(e).format()];return t||S.throwArgumentError("no matching error","signature",e),t}getSighash(e){if("string"==typeof e)try{e=this.getFunction(e)}catch(t){try{e=this.getError(e)}catch{throw t}}return(0,u.tu)(this.constructor,"getSighash")(e)}getEventTopic(e){return"string"==typeof e&&(e=this.getEvent(e)),(0,u.tu)(this.constructor,"getEventTopic")(e)}_decodeParams(e,t){return this._abiCoder.decode(e,t)}_encodeParams(e,t){return this._abiCoder.encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){"string"==typeof e&&(e=this.getError(e));const n=(0,p.lE)(t);return(0,p.Dv)(n.slice(0,4))!==this.getSighash(e)&&S.throwArgumentError(`data signature does not match error ${e.name}.`,"data",(0,p.Dv)(n)),this._decodeParams(e.inputs,n.slice(4))}encodeErrorResult(e,t){return"string"==typeof e&&(e=this.getError(e)),(0,p.Dv)((0,p.zo)([this.getSighash(e),this._encodeParams(e.inputs,t||[])]))}decodeFunctionData(e,t){"string"==typeof e&&(e=this.getFunction(e));const n=(0,p.lE)(t);return(0,p.Dv)(n.slice(0,4))!==this.getSighash(e)&&S.throwArgumentError(`data signature does not match function ${e.name}.`,"data",(0,p.Dv)(n)),this._decodeParams(e.inputs,n.slice(4))}encodeFunctionData(e,t){return"string"==typeof e&&(e=this.getFunction(e)),(0,p.Dv)((0,p.zo)([this.getSighash(e),this._encodeParams(e.inputs,t||[])]))}decodeFunctionResult(e,t){"string"==typeof e&&(e=this.getFunction(e));let n=(0,p.lE)(t),a=null,o="",s=null,c=null,d=null;switch(n.length%this._abiCoder._getWordSize()){case 0:try{return this._abiCoder.decode(e.outputs,n)}catch{}break;case 4:{const l=(0,p.Dv)(n.slice(0,4)),f=zt[l];if(f)s=this._abiCoder.decode(f.inputs,n.slice(4)),c=f.name,d=f.signature,f.reason&&(a=s[0]),"Error"===c?o=`; VM Exception while processing transaction: reverted with reason string ${JSON.stringify(s[0])}`:"Panic"===c&&(o=`; VM Exception while processing transaction: reverted with panic code ${s[0]}`);else try{const h=this.getError(l);s=this._abiCoder.decode(h.inputs,n.slice(4)),c=h.name,d=h.format()}catch{}break}}return S.throwError("call revert exception"+o,b.Yd.errors.CALL_EXCEPTION,{method:e.format(),data:(0,p.Dv)(t),errorArgs:s,errorName:c,errorSignature:d,reason:a})}encodeFunctionResult(e,t){return"string"==typeof e&&(e=this.getFunction(e)),(0,p.Dv)(this._abiCoder.encode(e.outputs,t||[]))}encodeFilterTopics(e,t){"string"==typeof e&&(e=this.getEvent(e)),t.length>e.inputs.length&&S.throwError("too many arguments for "+e.format(),b.Yd.errors.UNEXPECTED_ARGUMENT,{argument:"values",value:t});let n=[];e.anonymous||n.push(this.getEventTopic(e));const a=(o,s)=>"string"===o.type?(0,le.id)(s):"bytes"===o.type?(0,Ue.w)((0,p.Dv)(s)):("address"===o.type&&this._abiCoder.encode(["address"],[s]),(0,p.$m)((0,p.Dv)(s),32));for(t.forEach((o,s)=>{let c=e.inputs[s];c.indexed?null==o?n.push(null):"array"===c.baseType||"tuple"===c.baseType?S.throwArgumentError("filtering with tuples or arrays not supported","contract."+c.name,o):Array.isArray(o)?n.push(o.map(d=>a(c,d))):n.push(a(c,o)):null!=o&&S.throwArgumentError("cannot filter non-indexed parameters; must be null","contract."+c.name,o)});n.length&&null===n[n.length-1];)n.pop();return n}encodeEventLog(e,t){"string"==typeof e&&(e=this.getEvent(e));const n=[],a=[],o=[];return e.anonymous||n.push(this.getEventTopic(e)),t.length!==e.inputs.length&&S.throwArgumentError("event arguments/values mismatch","values",t),e.inputs.forEach((s,c)=>{const d=t[c];if(s.indexed)if("string"===s.type)n.push((0,le.id)(d));else if("bytes"===s.type)n.push((0,Ue.w)(d));else{if("tuple"===s.baseType||"array"===s.baseType)throw new Error("not implemented");n.push(this._abiCoder.encode([s.type],[d]))}else a.push(s),o.push(d)}),{data:this._abiCoder.encode(a,o),topics:n}}decodeEventLog(e,t,n){if("string"==typeof e&&(e=this.getEvent(e)),null!=n&&!e.anonymous){let g=this.getEventTopic(e);(!(0,p.A7)(n[0],32)||n[0].toLowerCase()!==g)&&S.throwError("fragment/topic mismatch",b.Yd.errors.INVALID_ARGUMENT,{argument:"topics[0]",expected:g,value:n[0]}),n=n.slice(1)}let a=[],o=[],s=[];e.inputs.forEach((g,A)=>{g.indexed?"string"===g.type||"bytes"===g.type||"tuple"===g.baseType||"array"===g.baseType?(a.push(x.fromObject({type:"bytes32",name:g.name})),s.push(!0)):(a.push(g),s.push(!1)):(o.push(g),s.push(!1))});let c=null!=n?this._abiCoder.decode(a,(0,p.zo)(n)):null,d=this._abiCoder.decode(o,t,!0),l=[],f=0,h=0;e.inputs.forEach((g,A)=>{if(g.indexed)if(null==c)l[A]=new Ce({_isIndexed:!0,hash:null});else if(s[A])l[A]=new Ce({_isIndexed:!0,hash:c[h++]});else try{l[A]=c[h++]}catch(O){l[A]=O}else try{l[A]=d[f++]}catch(O){l[A]=O}if(g.name&&null==l[g.name]){const O=l[A];O instanceof Error?Object.defineProperty(l,g.name,{enumerable:!0,get:()=>{throw qe(`property ${JSON.stringify(g.name)}`,O)}}):l[g.name]=O}});for(let g=0;g<l.length;g++){const A=l[g];A instanceof Error&&Object.defineProperty(l,g,{enumerable:!0,get:()=>{throw qe(`index ${g}`,A)}})}return Object.freeze(l)}parseTransaction(e){let t=this.getFunction(e.data.substring(0,10).toLowerCase());return t?new Zt({args:this._abiCoder.decode(t.inputs,"0x"+e.data.substring(10)),functionFragment:t,name:t.name,signature:t.format(),sighash:this.getSighash(t),value:G.O$.from(e.value||"0")}):null}parseLog(e){let t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new $t({eventFragment:t,name:t.name,signature:t.format(),topic:this.getEventTopic(t),args:this.decodeEventLog(t,e.data,e.topics)})}parseError(e){const t=(0,p.Dv)(e);let n=this.getError(t.substring(0,10).toLowerCase());return n?new Mt({args:this._abiCoder.decode(n.inputs,"0x"+t.substring(10)),errorFragment:n,name:n.name,signature:n.format(),sighash:this.getSighash(n)}):null}static isInterface(e){return!(!e||!e._isInterface)}}var Ut=_(2523),Ae=_(1979),Ft=_(896),D=function(i,e,t,n){return new(t||(t=Promise))(function(o,s){function c(f){try{l(n.next(f))}catch(h){s(h)}}function d(f){try{l(n.throw(f))}catch(h){s(h)}}function l(f){f.done?o(f.value):function a(o){return o instanceof t?o:new t(function(s){s(o)})}(f.value).then(c,d)}l((n=n.apply(i,e||[])).next())})};const w=new b.Yd("contracts/5.6.0"),Lt={chainId:!0,data:!0,from:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,type:!0,accessList:!0,maxFeePerGas:!0,maxPriorityFeePerGas:!0,customData:!0,ccipReadEnabled:!0};function he(i,e){return D(this,void 0,void 0,function*(){const t=yield e;"string"!=typeof t&&w.throwArgumentError("invalid address or ENS name","name",t);try{return(0,R.Kn)(t)}catch{}i||w.throwError("a provider or signer is needed to resolve ENS names",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"resolveName"});const n=yield i.resolveName(t);return null==n&&w.throwArgumentError("resolver or addr is not configured for ENS name","name",t),n})}function ne(i,e,t){return D(this,void 0,void 0,function*(){return Array.isArray(t)?yield Promise.all(t.map((n,a)=>ne(i,Array.isArray(e)?e[a]:e[n.name],n))):"address"===t.type?yield he(i,e):"tuple"===t.type?yield ne(i,e,t.components):"array"===t.baseType?Array.isArray(e)?yield Promise.all(e.map(n=>ne(i,n,t.arrayChildren))):Promise.reject(w.makeError("invalid value for array",b.Yd.errors.INVALID_ARGUMENT,{argument:"value",value:e})):e})}function be(i,e,t){return D(this,void 0,void 0,function*(){let n={};t.length===e.inputs.length+1&&"object"==typeof t[t.length-1]&&(n=(0,u.DC)(t.pop())),w.checkArgumentCount(t.length,e.inputs.length,"passed to contract"),i.signer?n.from=n.from?(0,u.mE)({override:he(i.signer,n.from),signer:i.signer.getAddress()}).then(l=>D(this,void 0,void 0,function*(){return(0,R.Kn)(l.signer)!==l.override&&w.throwError("Contract with a Signer cannot override from",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides.from"}),l.override})):i.signer.getAddress():n.from&&(n.from=he(i.provider,n.from));const a=yield(0,u.mE)({args:ne(i.signer||i.provider,t,e.inputs),address:i.resolvedAddress,overrides:(0,u.mE)(n)||{}}),o=i.interface.encodeFunctionData(e,a.args),s={data:o,to:a.address},c=a.overrides;if(null!=c.nonce&&(s.nonce=G.O$.from(c.nonce).toNumber()),null!=c.gasLimit&&(s.gasLimit=G.O$.from(c.gasLimit)),null!=c.gasPrice&&(s.gasPrice=G.O$.from(c.gasPrice)),null!=c.maxFeePerGas&&(s.maxFeePerGas=G.O$.from(c.maxFeePerGas)),null!=c.maxPriorityFeePerGas&&(s.maxPriorityFeePerGas=G.O$.from(c.maxPriorityFeePerGas)),null!=c.from&&(s.from=c.from),null!=c.type&&(s.type=c.type),null!=c.accessList&&(s.accessList=(0,Ft.z7)(c.accessList)),null==s.gasLimit&&null!=e.gas){let l=21e3;const f=(0,p.lE)(o);for(let h=0;h<f.length;h++)l+=4,f[h]&&(l+=64);s.gasLimit=G.O$.from(e.gas).add(l)}if(c.value){const l=G.O$.from(c.value);!l.isZero()&&!e.payable&&w.throwError("non-payable method cannot override value",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides.value",value:n.value}),s.value=l}c.customData&&(s.customData=(0,u.DC)(c.customData)),c.ccipReadEnabled&&(s.ccipReadEnabled=!!c.ccipReadEnabled),delete n.nonce,delete n.gasLimit,delete n.gasPrice,delete n.from,delete n.value,delete n.type,delete n.accessList,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.customData,delete n.ccipReadEnabled;const d=Object.keys(n).filter(l=>null!=n[l]);return d.length&&w.throwError(`cannot override ${d.map(l=>JSON.stringify(l)).join(",")}`,b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides",overrides:d}),s})}function Qe(i,e){const t=e.wait.bind(e);e.wait=n=>t(n).then(a=>(a.events=a.logs.map(o=>{let s=(0,u.p$)(o),c=null;try{c=i.interface.parseLog(o)}catch{}return c&&(s.args=c.args,s.decode=(d,l)=>i.interface.decodeEventLog(c.eventFragment,d,l),s.event=c.name,s.eventSignature=c.signature),s.removeListener=()=>i.provider,s.getBlock=()=>i.provider.getBlock(a.blockHash),s.getTransaction=()=>i.provider.getTransaction(a.transactionHash),s.getTransactionReceipt=()=>Promise.resolve(a),s}),a))}function He(i,e,t){const n=i.signer||i.provider;return function(...a){return D(this,void 0,void 0,function*(){let o;if(a.length===e.inputs.length+1&&"object"==typeof a[a.length-1]){const d=(0,u.DC)(a.pop());null!=d.blockTag&&(o=yield d.blockTag),delete d.blockTag,a.push(d)}null!=i.deployTransaction&&(yield i._deployed(o));const s=yield be(i,e,a),c=yield n.call(s,o);try{let d=i.interface.decodeFunctionResult(e,c);return t&&1===e.outputs.length&&(d=d[0]),d}catch(d){throw d.code===b.Yd.errors.CALL_EXCEPTION&&(d.address=i.address,d.args=a,d.transaction=s),d}})}}function We(i,e,t){return e.constant?He(i,e,t):function kt(i,e){return function(...t){return D(this,void 0,void 0,function*(){i.signer||w.throwError("sending a transaction requires a signer",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction"}),null!=i.deployTransaction&&(yield i._deployed());const n=yield be(i,e,t),a=yield i.signer.sendTransaction(n);return Qe(i,a),a})}}(i,e)}function Xe(i){return!i.address||null!=i.topics&&0!==i.topics.length?(i.address||"*")+"@"+(i.topics?i.topics.map(e=>Array.isArray(e)?e.join("|"):e).join(":"):""):"*"}class re{constructor(e,t){(0,u.zG)(this,"tag",e),(0,u.zG)(this,"filter",t),this._listeners=[]}addListener(e,t){this._listeners.push({listener:e,once:t})}removeListener(e){let t=!1;this._listeners=this._listeners.filter(n=>!(!t&&n.listener===e&&(t=!0,1)))}removeAllListeners(){this._listeners=[]}listeners(){return this._listeners.map(e=>e.listener)}listenerCount(){return this._listeners.length}run(e){const t=this.listenerCount();return this._listeners=this._listeners.filter(n=>{const a=e.slice();return setTimeout(()=>{n.listener.apply(this,a)},0),!n.once}),t}prepareEvent(e){}getEmit(e){return[e]}}class Vt extends re{constructor(){super("error",null)}}class Ke extends re{constructor(e,t,n,a){const o={address:e};let s=t.getEventTopic(n);a?(s!==a[0]&&w.throwArgumentError("topic mismatch","topics",a),o.topics=a.slice()):o.topics=[s],super(Xe(o),o),(0,u.zG)(this,"address",e),(0,u.zG)(this,"interface",t),(0,u.zG)(this,"fragment",n)}prepareEvent(e){super.prepareEvent(e),e.event=this.fragment.name,e.eventSignature=this.fragment.format(),e.decode=(t,n)=>this.interface.decodeEventLog(this.fragment,t,n);try{e.args=this.interface.decodeEventLog(this.fragment,e.data,e.topics)}catch(t){e.args=null,e.decodeError=t}}getEmit(e){const t=function mt(i){const e=[],t=function(n,a){if(Array.isArray(a))for(let o in a){const s=n.slice();s.push(o);try{t(s,a[o])}catch(c){e.push({path:s,error:c})}}};return t([],i),e}(e.args);if(t.length)throw t[0].error;const n=(e.args||[]).slice();return n.push(e),n}}class et extends re{constructor(e,t){super("*",{address:e}),(0,u.zG)(this,"address",e),(0,u.zG)(this,"interface",t)}prepareEvent(e){super.prepareEvent(e);try{const t=this.interface.parseLog(e);e.event=t.name,e.eventSignature=t.signature,e.decode=(n,a)=>this.interface.decodeEventLog(t.eventFragment,n,a),e.args=t.args}catch{}}}class me extends class Yt{constructor(e,t,n){w.checkNew(new.target,me),(0,u.zG)(this,"interface",(0,u.tu)(new.target,"getInterface")(t)),null==n?((0,u.zG)(this,"provider",null),(0,u.zG)(this,"signer",null)):Ae.E.isSigner(n)?((0,u.zG)(this,"provider",n.provider||null),(0,u.zG)(this,"signer",n)):Ut.zt.isProvider(n)?((0,u.zG)(this,"provider",n),(0,u.zG)(this,"signer",null)):w.throwArgumentError("invalid signer or provider","signerOrProvider",n),(0,u.zG)(this,"callStatic",{}),(0,u.zG)(this,"estimateGas",{}),(0,u.zG)(this,"functions",{}),(0,u.zG)(this,"populateTransaction",{}),(0,u.zG)(this,"filters",{});{const s={};Object.keys(this.interface.events).forEach(c=>{const d=this.interface.events[c];(0,u.zG)(this.filters,c,(...l)=>({address:this.address,topics:this.interface.encodeFilterTopics(d,l)})),s[d.name]||(s[d.name]=[]),s[d.name].push(c)}),Object.keys(s).forEach(c=>{const d=s[c];1===d.length?(0,u.zG)(this.filters,c,this.filters[d[0]]):w.warn(`Duplicate definition of ${c} (${d.join(", ")})`)})}if((0,u.zG)(this,"_runningEvents",{}),(0,u.zG)(this,"_wrappedEmits",{}),null==e&&w.throwArgumentError("invalid contract address or ENS name","addressOrName",e),(0,u.zG)(this,"address",e),this.provider)(0,u.zG)(this,"resolvedAddress",he(this.provider,e));else try{(0,u.zG)(this,"resolvedAddress",Promise.resolve((0,R.Kn)(e)))}catch{w.throwError("provider is required to use ENS name as contract address",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"new Contract"})}this.resolvedAddress.catch(s=>{});const a={},o={};Object.keys(this.interface.functions).forEach(s=>{const c=this.interface.functions[s];if(o[s])w.warn(`Duplicate ABI entry for ${JSON.stringify(s)}`);else{o[s]=!0;{const d=c.name;a[`%${d}`]||(a[`%${d}`]=[]),a[`%${d}`].push(s)}null==this[s]&&(0,u.zG)(this,s,We(this,c,!0)),null==this.functions[s]&&(0,u.zG)(this.functions,s,We(this,c,!1)),null==this.callStatic[s]&&(0,u.zG)(this.callStatic,s,He(this,c,!0)),null==this.populateTransaction[s]&&(0,u.zG)(this.populateTransaction,s,function Dt(i,e){return function(...t){return be(i,e,t)}}(this,c)),null==this.estimateGas[s]&&(0,u.zG)(this.estimateGas,s,function jt(i,e){const t=i.signer||i.provider;return function(...n){return D(this,void 0,void 0,function*(){t||w.throwError("estimate require a provider or signer",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"estimateGas"});const a=yield be(i,e,n);return yield t.estimateGas(a)})}}(this,c))}}),Object.keys(a).forEach(s=>{const c=a[s];if(c.length>1)return;s=s.substring(1);const d=c[0];try{null==this[s]&&(0,u.zG)(this,s,this[d])}catch{}null==this.functions[s]&&(0,u.zG)(this.functions,s,this.functions[d]),null==this.callStatic[s]&&(0,u.zG)(this.callStatic,s,this.callStatic[d]),null==this.populateTransaction[s]&&(0,u.zG)(this.populateTransaction,s,this.populateTransaction[d]),null==this.estimateGas[s]&&(0,u.zG)(this.estimateGas,s,this.estimateGas[d])})}static getContractAddress(e){return(0,R.CR)(e)}static getInterface(e){return te.isInterface(e)?e:new te(e)}deployed(){return this._deployed()}_deployed(e){return this._deployedPromise||(this._deployedPromise=this.deployTransaction?this.deployTransaction.wait().then(()=>this):this.provider.getCode(this.address,e).then(t=>("0x"===t&&w.throwError("contract not deployed",b.Yd.errors.UNSUPPORTED_OPERATION,{contractAddress:this.address,operation:"getDeployed"}),this))),this._deployedPromise}fallback(e){this.signer||w.throwError("sending a transactions require a signer",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction(fallback)"});const t=(0,u.DC)(e||{});return["from","to"].forEach(function(n){null!=t[n]&&w.throwError("cannot override "+n,b.Yd.errors.UNSUPPORTED_OPERATION,{operation:n})}),t.to=this.resolvedAddress,this.deployed().then(()=>this.signer.sendTransaction(t))}connect(e){"string"==typeof e&&(e=new Ae.b(e,this.provider));const t=new this.constructor(this.address,this.interface,e);return this.deployTransaction&&(0,u.zG)(t,"deployTransaction",this.deployTransaction),t}attach(e){return new this.constructor(e,this.interface,this.signer||this.provider)}static isIndexed(e){return Ce.isIndexed(e)}_normalizeRunningEvent(e){return this._runningEvents[e.tag]?this._runningEvents[e.tag]:e}_getRunningEvent(e){if("string"==typeof e){if("error"===e)return this._normalizeRunningEvent(new Vt);if("event"===e)return this._normalizeRunningEvent(new re("event",null));if("*"===e)return this._normalizeRunningEvent(new et(this.address,this.interface));const t=this.interface.getEvent(e);return this._normalizeRunningEvent(new Ke(this.address,this.interface,t))}if(e.topics&&e.topics.length>0){try{const n=e.topics[0];if("string"!=typeof n)throw new Error("invalid topic");const a=this.interface.getEvent(n);return this._normalizeRunningEvent(new Ke(this.address,this.interface,a,e.topics))}catch{}const t={address:this.address,topics:e.topics};return this._normalizeRunningEvent(new re(Xe(t),t))}return this._normalizeRunningEvent(new et(this.address,this.interface))}_checkRunningEvents(e){if(0===e.listenerCount()){delete this._runningEvents[e.tag];const t=this._wrappedEmits[e.tag];t&&e.filter&&(this.provider.off(e.filter,t),delete this._wrappedEmits[e.tag])}}_wrapEvent(e,t,n){const a=(0,u.p$)(t);return a.removeListener=()=>{!n||(e.removeListener(n),this._checkRunningEvents(e))},a.getBlock=()=>this.provider.getBlock(t.blockHash),a.getTransaction=()=>this.provider.getTransaction(t.transactionHash),a.getTransactionReceipt=()=>this.provider.getTransactionReceipt(t.transactionHash),e.prepareEvent(a),a}_addEventListener(e,t,n){if(this.provider||w.throwError("events require a provider or a signer with a provider",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"once"}),e.addListener(t,n),this._runningEvents[e.tag]=e,!this._wrappedEmits[e.tag]){const a=o=>{let s=this._wrapEvent(e,o,t);if(null==s.decodeError)try{const c=e.getEmit(s);this.emit(e.filter,...c)}catch(c){s.decodeError=c.error}null!=e.filter&&this.emit("event",s),null!=s.decodeError&&this.emit("error",s.decodeError,s)};this._wrappedEmits[e.tag]=a,null!=e.filter&&this.provider.on(e.filter,a)}}queryFilter(e,t,n){const a=this._getRunningEvent(e),o=(0,u.DC)(a.filter);return"string"==typeof t&&(0,p.A7)(t,32)?(null!=n&&w.throwArgumentError("cannot specify toBlock with blockhash","toBlock",n),o.blockHash=t):(o.fromBlock=t??0,o.toBlock=n??"latest"),this.provider.getLogs(o).then(s=>s.map(c=>this._wrapEvent(a,c,null)))}on(e,t){return this._addEventListener(this._getRunningEvent(e),t,!1),this}once(e,t){return this._addEventListener(this._getRunningEvent(e),t,!0),this}emit(e,...t){if(!this.provider)return!1;const n=this._getRunningEvent(e),a=n.run(t)>0;return this._checkRunningEvents(n),a}listenerCount(e){return this.provider?null==e?Object.keys(this._runningEvents).reduce((t,n)=>t+this._runningEvents[n].listenerCount(),0):this._getRunningEvent(e).listenerCount():0}listeners(e){if(!this.provider)return[];if(null==e){const t=[];for(let n in this._runningEvents)this._runningEvents[n].listeners().forEach(a=>{t.push(a)});return t}return this._getRunningEvent(e).listeners()}removeAllListeners(e){if(!this.provider)return this;if(null==e){for(const n in this._runningEvents){const a=this._runningEvents[n];a.removeAllListeners(),this._checkRunningEvents(a)}return this}const t=this._getRunningEvent(e);return t.removeAllListeners(),this._checkRunningEvents(t),this}off(e,t){if(!this.provider)return this;const n=this._getRunningEvent(e);return n.removeListener(t),this._checkRunningEvents(n),this}removeListener(e,t){return this.off(e,t)}}{}const ye=[{inputs:[{internalType:"address",name:"_boardSetupVerifier",type:"address"},{internalType:"address",name:"_fireShotVerifier",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_gameId",type:"uint256"},{indexed:!1,internalType:"address",name:"_by",type:"address"}],name:"Joined",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_gameId",type:"uint256"},{indexed:!1,internalType:"uint8",name:"_shotIndex",type:"uint8"}],name:"ShotFired",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_gameId",type:"uint256"},{indexed:!1,internalType:"uint8",name:"_shipId",type:"uint8"}],name:"ShotLanded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_gameId",type:"uint256"},{indexed:!1,internalType:"address",name:"_by",type:"address"}],name:"Started",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"_gameId",type:"uint256"},{indexed:!1,internalType:"address",name:"_by",type:"address"}],name:"Won",type:"event"},{inputs:[],name:"WIN_HIT_COUNT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"gameIndex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_gameId",type:"uint256"}],name:"gameState",outputs:[{internalType:"address[2]",name:"_participants",type:"address[2]"},{internalType:"uint256[2]",name:"_boards",type:"uint256[2]"},{internalType:"uint256",name:"_turn",type:"uint256"},{internalType:"uint256[2]",name:"_hits",type:"uint256[2]"},{internalType:"address",name:"_winner",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"games",outputs:[{internalType:"uint256",name:"turn",type:"uint256"},{internalType:"address",name:"winner",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_gameId",type:"uint256"},{internalType:"uint256",name:"_boardHash",type:"uint256"},{internalType:"uint256[2]",name:"a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"c",type:"uint256[2]"}],name:"joinGame",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_gameId",type:"uint256"},{internalType:"uint256",name:"_turnShotIndex",type:"uint256"}],name:"playFirstTurn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_gameId",type:"uint256"},{internalType:"uint256",name:"_hitShipId",type:"uint256"},{internalType:"uint256",name:"_prevTurnShotIndex",type:"uint256"},{internalType:"uint256",name:"_turnShotIndex",type:"uint256"},{internalType:"uint256[2]",name:"a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"c",type:"uint256[2]"}],name:"playTurn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_boardHash",type:"uint256"},{internalType:"uint256[2]",name:"a",type:"uint256[2]"},{internalType:"uint256[2][2]",name:"b",type:"uint256[2][2]"},{internalType:"uint256[2]",name:"c",type:"uint256[2]"}],name:"startGame",outputs:[],stateMutability:"nonpayable",type:"function"}],tt="0x608060405234801561001057600080fd5b5060405161118138038061118183398101604081905261002f9161007c565b600280546001600160a01b039384166001600160a01b031991821617909155600380549290931691161790556100af565b80516001600160a01b038116811461007757600080fd5b919050565b6000806040838503121561008f57600080fd5b61009883610060565b91506100a660208401610060565b90509250929050565b6110c3806100be6000396000f3fe608060405234801561001057600080fd5b50600436106100885760003560e01c80635654a3411161005b5780635654a34114610131578063763cb3421461013a57806380bdf5d41461014d578063b8ccd40f1461016057600080fd5b8063117a5b901461008d578063498c1b90146100e25780634a11e01f146100f85780634e0e1a3e1461010d575b600080fd5b6100c061009b366004610be3565b600160205260009081526040902060048101546008909101546001600160a01b031682565b604080519283526001600160a01b039091166020830152015b60405180910390f35b6100ea601181565b6040519081526020016100d9565b61010b610106366004610bfc565b610173565b005b61012061011b366004610be3565b6102e1565b6040516100d9959493929190610c47565b6100ea60005481565b61010b610148366004610d8d565b6103c9565b61010b61015b366004610de9565b610557565b61010b61016e366004610e58565b610a72565b60008281526001602052604090206004810154156101ce5760405162461bcd60e51b81526020600482015260136024820152724e6f7420746865206669727374207475726e2160681b60448201526064015b60405180910390fd5b80600001546001600160a01b031633146102165760405162461bcd60e51b81526020600482015260096024820152684e6f74207475726e2160b81b60448201526064016101c5565b606482106102665760405162461bcd60e51b815260206004820152601960248201527f53686f7420636f6f7264696e6174657320696e76616c6964210000000000000060448201526064016101c5565b600481015460008381526005830160205260409081902091909155517f856b88170e0caeb4b11ef613cb3df1eb1f59ef2c26d3fed6dbd995b325c5ae16906102bd908590859091825260ff16602082015260400190565b60405180910390a16004810180549060006102d783610ed5565b9190505550505050565b6102e9610bc5565b6102f1610bc5565b60006102fb610bc5565b6000858152600160205260408082208151808301928390529091829060029082845b81546001600160a01b0316815260019091019060200180831161031d5750506040805180820191829052949a50600286810194509250905082845b81548152602001906001019080831161035857505050506004830154604080518082019182905293985090965060068401915060029082845b815481526020019060010190808311610391575050506008909301549799969850949690956001600160a01b03909116945092505050565b6000858152600160208190526040822091908201546001600160a01b0316146104295760405162461bcd60e51b815260206004820152601260248201527147616d6520616c72656164792066756c6c2160701b60448201526064016101c5565b6002546040805160208101825287815290516343753b4d60e01b81526001600160a01b03909216916343753b4d9161046a9188918891889190600401610f46565b602060405180830381865afa158015610487573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906104ab9190610fa3565b6104f75760405162461bcd60e51b815260206004820152601b60248201527f496e76616c6964207368697020636f6e66696775726174696f6e21000000000060448201526064016101c5565b6001810180546001600160a01b03191633908117909155600382018690556040805188815260208101929092527fc0081eeafa0d002abcd7d58d84b6e688d1526b9c3d915a282212ba08c49a17a7910160405180910390a1505050505050565b60008781526001602081905260408220600481015490929160029161057c9190610fcc565b6105869190610fe3565b905060006002836004015461059b9190610fe3565b905060008360040154116105e35760405162461bcd60e51b815260206004820152600f60248201526e546865206669727374207475726e2160881b60448201526064016101c5565b8281600281106105f5576105f5610ea9565b01546001600160a01b0316331461063a5760405162461bcd60e51b81526020600482015260096024820152684e6f74207475726e2160b81b60448201526064016101c5565b60088301546001600160a01b03161561068a5760405162461bcd60e51b815260206004820152601260248201527147616d6520616c7265616479206f7665722160701b60448201526064016101c5565b606487106106da5760405162461bcd60e51b815260206004820152601e60248201527f4e6578742073686f7420636f6f7264696e6174657320696e76616c696421000060448201526064016101c5565b6005830160006106eb846064611005565b6106f5908b611024565b815260200190815260200160002054600184600401546107159190610fcc565b146107755760405162461bcd60e51b815260206004820152602a60248201527f496e636f72726563742073686f7420666f722070726576696f7573207475726e6044820152692070726f76696465642160b01b60648201526084016101c5565b600360009054906101000a90046001600160a01b03166001600160a01b03166311479fea87878760405180606001604052808f81526020018960020188600281106107c2576107c2610ea9565b015481526020018e8152506040518563ffffffff1660e01b81526004016107ec949392919061103c565b602060405180830381865afa158015610809573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061082d9190610fa3565b61086a5760405162461bcd60e51b815260206004820152600e60248201526d496e76616c69642070726f6f662160901b60448201526064016101c5565b881561089a5782600601826002811061088557610885610ea9565b01805490600061089483610ed5565b91905055505b604080518b815260ff8b1660208201527f8f78455e6cc82b42f8dc866bf3befc9b590f0ad419058f342ccab8f2cf4fcf19910160405180910390a160118360060183600281106108ec576108ec610ea9565b0154106109665782826002811061090557610905610ea9565b01546008840180546001600160a01b0319166001600160a01b039092169182179055604080518c815260208101929092527f34fee8cf8c6f9d389d6b16d4f6676f2d68632f123b5a7c3a4dd48b0ec7fac014910160405180910390a1610a66565b600583016000610977836064611005565b610981908a611024565b8152602001908152602001600020546000146109d75760405162461bcd60e51b815260206004820152601560248201527453686f7473206d75737420626520756e697175652160581b60448201526064016101c5565b60048301546005840160006109ed846064611005565b6109f7908b611024565b8152602001908152602001600020819055507f856b88170e0caeb4b11ef613cb3df1eb1f59ef2c26d3fed6dbd995b325c5ae168a88604051610a4692919091825260ff16602082015260400190565b60405180910390a1600483018054906000610a6083610ed5565b91905055505b50505050505050505050565b6002546040805160208101825286815290516343753b4d60e01b81526001600160a01b03909216916343753b4d91610ab39187918791879190600401610f46565b602060405180830381865afa158015610ad0573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610af49190610fa3565b610b405760405162461bcd60e51b815260206004820152601b60248201527f496e76616c6964207368697020636f6e66696775726174696f6e21000000000060448201526064016101c5565b60008054815260016020908152604080832080546001600160a01b031916339081179091558354845281842060020188905592548151908152918201929092527fcb88c87e28a0e0b68deef72d3d3536c607260b8c80944e6117a896f855eed81f910160405180910390a1600080549080610bba83610ed5565b919050555050505050565b60405180604001604052806002906020820280368337509192915050565b600060208284031215610bf557600080fd5b5035919050565b60008060408385031215610c0f57600080fd5b50508035926020909101359150565b8060005b6002811015610c41578151845260209384019390910190600101610c22565b50505050565b6101008101818760005b6002811015610c795781516001600160a01b0316835260209283019290910190600101610c51565b505050610c896040830187610c1e565b846080830152610c9c60a0830185610c1e565b6001600160a01b039290921660e09190910152949350505050565b6040805190810167ffffffffffffffff81118282101715610ce857634e487b7160e01b600052604160045260246000fd5b60405290565b600082601f830112610cff57600080fd5b610d07610cb7565b806040840185811115610d1957600080fd5b845b81811015610d33578035845260209384019301610d1b565b509095945050505050565b600082601f830112610d4f57600080fd5b610d57610cb7565b806080840185811115610d6957600080fd5b845b81811015610d3357610d7d8782610cee565b8452602090930192604001610d6b565b60008060008060006101408688031215610da657600080fd5b8535945060208601359350610dbe8760408801610cee565b9250610dcd8760808801610d3e565b9150610ddd876101008801610cee565b90509295509295909350565b6000806000806000806000610180888a031215610e0557600080fd5b87359650602088013595506040880135945060608801359350610e2b8960808a01610cee565b9250610e3a8960c08a01610d3e565b9150610e4a896101408a01610cee565b905092959891949750929550565b6000806000806101208587031215610e6f57600080fd5b84359350610e808660208701610cee565b9250610e8f8660608701610d3e565b9150610e9e8660e08701610cee565b905092959194509250565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b600060018201610ee757610ee7610ebf565b5060010190565b806000805b6002808210610f025750610f3f565b835186845b83811015610f25578251825260209283019290910190600101610f07565b505050604095909501945060209290920191600101610ef3565b5050505050565b6101208101610f558287610c1e565b610f626040830186610eee565b610f6f60c0830185610c1e565b61010082018360005b6001811015610f97578151835260209283019290910190600101610f78565b50505095945050505050565b600060208284031215610fb557600080fd5b81518015158114610fc557600080fd5b9392505050565b600082821015610fde57610fde610ebf565b500390565b60008261100057634e487b7160e01b600052601260045260246000fd5b500690565b600081600019048311821515161561101f5761101f610ebf565b500290565b6000821982111561103757611037610ebf565b500190565b610160810161104b8287610c1e565b6110586040830186610eee565b61106560c0830185610c1e565b61010082018360005b6003811015610f9757815183526020928301929091019060010161106e56fea2646970667358221220d1028182c6305ea7c9b5ebe9a1d097334ae3958ca17e7ca9380fec7636900ba364736f6c634300080d0033";let Qt=(()=>{class i extends class Jt{constructor(e,t,n){let a=null;a="string"==typeof t?t:(0,p._t)(t)?(0,p.Dv)(t):t&&"string"==typeof t.object?t.object:"!","0x"!==a.substring(0,2)&&(a="0x"+a),(!(0,p.A7)(a)||a.length%2)&&w.throwArgumentError("invalid bytecode","bytecode",t),n&&!Ae.E.isSigner(n)&&w.throwArgumentError("invalid signer","signer",n),(0,u.zG)(this,"bytecode",a),(0,u.zG)(this,"interface",(0,u.tu)(new.target,"getInterface")(e)),(0,u.zG)(this,"signer",n||null)}getDeployTransaction(...e){let t={};if(e.length===this.interface.deploy.inputs.length+1&&"object"==typeof e[e.length-1]){t=(0,u.DC)(e.pop());for(const n in t)if(!Lt[n])throw new Error("unknown transaction override "+n)}return["data","from","to"].forEach(n=>{null!=t[n]&&w.throwError("cannot override "+n,b.Yd.errors.UNSUPPORTED_OPERATION,{operation:n})}),t.value&&!G.O$.from(t.value).isZero()&&!this.interface.deploy.payable&&w.throwError("non-payable constructor cannot override value",b.Yd.errors.UNSUPPORTED_OPERATION,{operation:"overrides.value",value:t.value}),w.checkArgumentCount(e.length,this.interface.deploy.inputs.length," in Contract constructor"),t.data=(0,p.Dv)((0,p.zo)([this.bytecode,this.interface.encodeDeploy(e)])),t}deploy(...e){return D(this,void 0,void 0,function*(){let t={};e.length===this.interface.deploy.inputs.length+1&&(t=e.pop()),w.checkArgumentCount(e.length,this.interface.deploy.inputs.length," in Contract constructor");const n=yield ne(this.signer,e,this.interface.deploy.inputs);n.push(t);const a=this.getDeployTransaction(...n),o=yield this.signer.sendTransaction(a),s=(0,u.tu)(this.constructor,"getContractAddress")(o),c=(0,u.tu)(this.constructor,"getContract")(s,this.interface,this.signer);return Qe(c,o),(0,u.zG)(c,"deployTransaction",o),c})}attach(e){return this.constructor.getContract(e,this.interface,this.signer)}connect(e){return new this.constructor(this.interface,this.bytecode,e)}static fromSolidity(e,t){null==e&&w.throwError("missing compiler output",b.Yd.errors.MISSING_ARGUMENT,{argument:"compilerOutput"}),"string"==typeof e&&(e=JSON.parse(e));let a=null;return e.bytecode?a=e.bytecode:e.evm&&e.evm.bytecode&&(a=e.evm.bytecode),new this(e.abi,a,t)}static getInterface(e){return me.getInterface(e)}static getContractAddress(e){return(0,R.CR)(e)}static getContract(e,t,n){return new me(e,t,n)}}{constructor(...t){(i=>i.length>1)(t)?super(...t):super(ye,tt,t[0])}deploy(t,n,a){return super.deploy(t,n,a||{})}getDeployTransaction(t,n,a){return super.getDeployTransaction(t,n,a||{})}attach(t){return super.attach(t)}connect(t){return super.connect(t)}static createInterface(){return new te(ye)}static connect(t,n){return new me(t,ye,n)}}return i.bytecode=tt,i.abi=ye,i})();var Ht=_(7935);let Ge=(()=>{class i{constructor(t){this.wallet=t,this.gameContract$=this.wallet.signer$.pipe((0,E.U)(n=>Qt.connect(Ht.N.gameContractAddress,n)),(0,v.d)(1))}startGame({boardHash:t,pi_a:n,pi_b:a,pi_c:o}){var s=this;return(0,I.Z)(function*(){const l=(yield(yield C(s.gameContract$)).startGame(t,n,a,o).then(f=>f.wait(1))).events?.find(f=>"Started"===f.event);if(!l)throw Error("Game started event not found!");return l.args._gameId.toBigInt()})()}joinGame(t,{boardHash:n,pi_a:a,pi_b:o,pi_c:s}){var c=this;return(0,I.Z)(function*(){yield(yield C(c.gameContract$)).joinGame(t,n,a,o,s).then(l=>l.wait(1))})()}playFirstTurn(t,n){var a=this;return(0,I.Z)(function*(){yield(yield C(a.gameContract$)).playFirstTurn(t,n).then(s=>s.wait(1))})()}playTurn(t,n,a,{hitShipId:o,pi_a:s,pi_b:c,pi_c:d}){var l=this;return(0,I.Z)(function*(){yield(yield C(l.gameContract$)).playTurn(t,o,n,a,s,c,d).then(h=>h.wait(1))})()}}return i.\u0275fac=function(t){return new(t||i)(r.LFG(ae.X))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Ie=(()=>{class i{constructor(t){this.storage=t.defaultView.localStorage}getGameBoard(t,n){var a=this;return(0,I.Z)(function*(){const o=a.storage.getItem(`${t} - ${n}`);if(o)return a.deserializeBoard(o)})()}storeGameBoard(t,n,a){var o=this;return(0,I.Z)(function*(){o.storage.setItem(`${t} - ${n}`,o.serializeBoard(a))})()}serializeBoard({ships:t,trapdoor:n,hash:a}){const o={ships:t.map(s=>s.map(c=>c.toString())),trapdoor:n.toString(),hash:a.toString()};return JSON.stringify(o)}deserializeBoard(t){const n=JSON.parse(t);return{ships:n.ships.map(a=>a.map(o=>BigInt(o))),trapdoor:BigInt(n.trapdoor),hash:BigInt(n.hash)}}}return i.\u0275fac=function(t){return new(t||i)(r.LFG(T.K0))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Wt=(()=>{class i{constructor(t,n,a,o,s){this.wallet=t,this.gameProver=n,this.gameContract=a,this.gameStorage=o,this.router=s,this.playerCreatingGame$=new ie.X(!1)}ngOnInit(){}createGame(){var t=this;return(0,I.Z)(function*(){if(!(yield C(t.playerCreatingGame$))){t.playerCreatingGame$.next(!0);try{const a=yield C(t.wallet.address$),o=yield C(t.fleetSetupBoard.fleetConfiguration$).then(l=>l),s=ze(),c=yield t.gameProver.generateBoardSetupProof(o,s),d=yield t.gameContract.startGame(c);yield t.gameStorage.storeGameBoard(d,a,{ships:o,trapdoor:s,hash:c.boardHash}),yield t.router.navigate(["games",d,"play"])}finally{t.playerCreatingGame$.next(!1)}}})()}}return i.\u0275fac=function(t){return new(t||i)(r.Y36(ae.X),r.Y36(Te),r.Y36(Ge),r.Y36(Ie),r.Y36($.F0))},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-game-create"]],viewQuery:function(t,n){if(1&t&&r.Gf(se,7),2&t){let a;r.iGM(a=r.CRH())&&(n.fleetSetupBoard=a.first)}},decls:15,vars:7,consts:[[1,"text-center"],[1,"btn","btn-primary",3,"disabled","click"],[1,"position-fixed","bottom-0","end-0","p-3",2,"z-index","11"],["id","liveToast","role","alert","aria-live","assertive","aria-atomic","true",1,"toast"],[1,"toast-header"],[1,"me-auto"],[1,"toast-body"]],template:function(t,n){1&t&&(r.TgZ(0,"h1",0),r._uU(1,"Deploy your fleet!"),r.qZA(),r._UZ(2,"app-fleet-setup-board"),r.TgZ(3,"div",0)(4,"button",1),r.NdJ("click",function(){return n.createGame()}),r.ALo(5,"async"),r._uU(6," Create game "),r.qZA()(),r.TgZ(7,"div",2)(8,"div",3),r.ALo(9,"async"),r.TgZ(10,"div",4)(11,"strong",5),r._uU(12,"Battleship3"),r.qZA()(),r.TgZ(13,"div",6),r._uU(14,"Creating game..."),r.qZA()()()),2&t&&(r.xp6(4),r.Q6J("disabled",!r.lcZ(5,3,n.fleetSetupBoard.fleetComplete$)),r.xp6(4),r.ekj("show",r.lcZ(9,5,n.playerCreatingGame$)))},directives:[se],pipes:[T.Ov],styles:[""]}),i})(),Xt=(()=>{class i{constructor(t,n,a,o,s,c){this.wallet=t,this.gameProver=n,this.gameContract=a,this.gameStorage=o,this.route=s,this.router=c,this.gameId$=this.route.paramMap.pipe((0,E.U)(d=>BigInt(d.get("gameId"))),(0,v.d)(1)),this.playerJoiningGame$=new ie.X(!1)}ngOnInit(){}joinGame(){var t=this;return(0,I.Z)(function*(){if(!(yield C(t.playerJoiningGame$))){t.playerJoiningGame$.next(!0);try{const a=yield C(t.wallet.address$),o=yield C(t.fleetSetupBoard.fleetConfiguration$).then(l=>l),s=ze(),c=yield t.gameProver.generateBoardSetupProof(o,s),d=yield C(t.gameId$);yield t.gameContract.joinGame(d,c),yield t.gameStorage.storeGameBoard(d,a,{ships:o,trapdoor:s,hash:c.boardHash}),yield t.router.navigate(["games",d,"play"])}finally{t.playerJoiningGame$.next(!1)}}})()}}return i.\u0275fac=function(t){return new(t||i)(r.Y36(ae.X),r.Y36(Te),r.Y36(Ge),r.Y36(Ie),r.Y36($.gz),r.Y36($.F0))},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-game-join"]],viewQuery:function(t,n){if(1&t&&r.Gf(se,7),2&t){let a;r.iGM(a=r.CRH())&&(n.fleetSetupBoard=a.first)}},decls:15,vars:7,consts:[[1,"text-center"],[1,"btn","btn-primary",3,"disabled","click"],[1,"position-fixed","bottom-0","end-0","p-3",2,"z-index","11"],["id","liveToast","role","alert","aria-live","assertive","aria-atomic","true",1,"toast"],[1,"toast-header"],[1,"me-auto"],[1,"toast-body"]],template:function(t,n){1&t&&(r.TgZ(0,"h1",0),r._uU(1,"Deploy your fleet!"),r.qZA(),r._UZ(2,"app-fleet-setup-board"),r.TgZ(3,"div",0)(4,"button",1),r.NdJ("click",function(){return n.joinGame()}),r.ALo(5,"async"),r._uU(6," Join game "),r.qZA()(),r.TgZ(7,"div",2)(8,"div",3),r.ALo(9,"async"),r.TgZ(10,"div",4)(11,"strong",5),r._uU(12,"Battleship3"),r.qZA()(),r.TgZ(13,"div",6),r._uU(14,"Joining game..."),r.qZA()()()),2&t&&(r.xp6(4),r.Q6J("disabled",!r.lcZ(5,3,n.fleetSetupBoard.fleetComplete$)),r.xp6(4),r.ekj("show",r.lcZ(9,5,n.playerJoiningGame$)))},directives:[se],pipes:[T.Ov],styles:[""]}),i})();var nt=_(1063),Kt=_(833),Y=_(2862),J=_(5554),q=(()=>{return(i=q||(q={})).Joined="JOINED",i.Over="OVER",i.Started="STARTED",q;var i})(),Q=(()=>{return(i=Q||(Q={})).Battleship="BATTLESHIP",i.Carrier="CARRIER",i.Cruiser="CRUISER",i.Destroyer="DESTROYER",i.Miss="MISS",i.Submarine="SUBMARINE",i.Unknown="UNKNOWN",Q;var i})();const e0=J.Ps`
    query GamePlay($gameId: ID!) {
  game(id: $gameId) {
    id
    status
    turn
    startedBy
    joinedBy
    wonBy
    shots(orderBy: turn, orderDirection: asc) {
      id
      status
      turn
      x
      y
    }
  }
}
    `;let t0=(()=>{class i extends J.AE{constructor(t){super(t),this.document=e0}}return i.\u0275fac=function(t){return new(t||i)(r.LFG(J._M))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const n0=J.Ps`
    query StartedGames {
  games(where: {status: STARTED}) {
    id
    startedBy
  }
}
    `;let r0=(()=>{class i extends J.AE{constructor(t){super(t),this.document=n0}}return i.\u0275fac=function(t){return new(t||i)(r.LFG(J._M))},i.\u0275prov=r.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function s0(i,e){1&i&&(r.TgZ(0,"h1",9),r._uU(1," Waiting for opponent... "),r.qZA())}function a0(i,e){1&i&&(r.TgZ(0,"h1",9),r._uU(1,"Your turn!"),r.qZA())}function o0(i,e){1&i&&(r.TgZ(0,"h1",9),r._uU(1," Waiting for opponent turn... "),r.qZA())}function c0(i,e){1&i&&(r.TgZ(0,"h1",9),r._uU(1,"You won!"),r.qZA())}function l0(i,e){1&i&&(r.TgZ(0,"h1",9),r._uU(1,"You lost!"),r.qZA())}function d0(i,e){if(1&i&&(r.TgZ(0,"th"),r._uU(1),r.qZA()),2&i){const t=e.$implicit;r.xp6(1),r.Oqu(t)}}function u0(i,e){if(1&i&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&i){const t=r.oxw().ngIf;r.xp6(1),r.hij(" ",t.ship.id," ")}}function f0(i,e){if(1&i&&(r.TgZ(0,"td"),r.YNc(1,u0,2,1,"span",7),r.qZA()),2&i){const t=e.ngIf;r.ekj("shot-miss",t.present&&!t.ship)("shot-hit",t.present&&t.ship),r.xp6(1),r.Q6J("ngIf",t.ship)}}const p0=function(i,e){return{present:i,ship:e}};function h0(i,e){if(1&i&&(r.ynx(0),r.YNc(1,f0,2,5,"td",19),r.BQk()),2&i){const t=e.index,n=r.oxw().index,a=r.oxw().ngIf,o=r.oxw().ngIf;r.xp6(1),r.Q6J("ngIf",r.WLB(1,p0,!!a[t][n],o[t][n]))}}function b0(i,e){if(1&i&&(r.TgZ(0,"tr")(1,"th"),r._uU(2),r.qZA(),r.YNc(3,h0,2,4,"ng-container",18),r.qZA()),2&i){const t=e.$implicit,n=r.oxw(3);r.xp6(2),r.Oqu(t),r.xp6(1),r.Q6J("ngForOf",n.columns)}}function m0(i,e){if(1&i&&(r.TgZ(0,"table",17)(1,"tr"),r._UZ(2,"th"),r.YNc(3,d0,2,1,"th",18),r.qZA(),r.YNc(4,b0,4,2,"tr",18),r.qZA()),2&i){const t=r.oxw(2);r.xp6(3),r.Q6J("ngForOf",t.columns),r.xp6(1),r.Q6J("ngForOf",t.rows)}}function y0(i,e){if(1&i&&(r.ynx(0),r.YNc(1,m0,5,2,"table",16),r.ALo(2,"async"),r.BQk()),2&i){const t=r.oxw();r.xp6(1),r.Q6J("ngIf",r.lcZ(2,1,t.opponentShotsBoard$))}}function g0(i,e){if(1&i&&(r.TgZ(0,"th"),r._uU(1),r.qZA()),2&i){const t=e.$implicit;r.xp6(1),r.Oqu(t)}}function _0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"U"),r.qZA())}function w0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"M"),r.qZA())}function S0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"CA"),r.qZA())}function T0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"B"),r.qZA())}function E0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"CR"),r.qZA())}function x0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"S"),r.qZA())}function v0(i,e){1&i&&(r.TgZ(0,"span"),r._uU(1,"D"),r.qZA())}function C0(i,e){if(1&i&&(r.TgZ(0,"td",23),r.YNc(1,_0,2,0,"span",24),r.YNc(2,w0,2,0,"span",24),r.YNc(3,S0,2,0,"span",24),r.YNc(4,T0,2,0,"span",24),r.YNc(5,E0,2,0,"span",24),r.YNc(6,x0,2,0,"span",24),r.YNc(7,v0,2,0,"span",24),r.qZA()),2&i){const t=e.ngIf,n=r.oxw(4);r.ekj("shot-miss",t.status===n.ShotStatus.Miss)("shot-hit",t.status!==n.ShotStatus.Unknown&&t.status!==n.ShotStatus.Miss),r.Q6J("ngSwitch",t.status),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Unknown),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Miss),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Carrier),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Battleship),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Cruiser),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Submarine),r.xp6(1),r.Q6J("ngSwitchCase",n.ShotStatus.Destroyer)}}function A0(i,e){if(1&i){const t=r.EpF();r.TgZ(0,"td",25),r.NdJ("click",function(){r.CHM(t);const a=r.oxw().index,o=r.oxw().index;return r.oxw(2).selectPlayerTurnShotLocation(a,o)}),r.qZA()}if(2&i){const t=r.oxw().index,n=r.oxw().index,a=r.oxw(2);r.ekj("selected",a.playerShotLocationIsSelected(t,n))}}function G0(i,e){if(1&i&&(r.ynx(0),r.YNc(1,C0,8,12,"td",21),r.YNc(2,A0,1,2,"ng-template",null,22,r.W1O),r.BQk()),2&i){const t=e.index,n=r.MAs(3),a=r.oxw().index,o=r.oxw().ngIf;r.xp6(1),r.Q6J("ngIf",o[t][a])("ngIfElse",n)}}function I0(i,e){if(1&i&&(r.TgZ(0,"tr")(1,"th"),r._uU(2),r.qZA(),r.YNc(3,G0,4,2,"ng-container",18),r.qZA()),2&i){const t=e.$implicit,n=r.oxw(2);r.xp6(2),r.Oqu(t),r.xp6(1),r.Q6J("ngForOf",n.columns)}}function O0(i,e){if(1&i&&(r.TgZ(0,"table",20)(1,"tr"),r._UZ(2,"th"),r.YNc(3,g0,2,1,"th",18),r.qZA(),r.YNc(4,I0,4,2,"tr",18),r.qZA()),2&i){const t=r.oxw();r.xp6(3),r.Q6J("ngForOf",t.columns),r.xp6(1),r.Q6J("ngForOf",t.rows)}}var N=(()=>{return(i=N||(N={}))[i.WaitingForOpponent=0]="WaitingForOpponent",i[i.PlayerTurn=1]="PlayerTurn",i[i.OpponentTurn=2]="OpponentTurn",i[i.PlayerWon=3]="PlayerWon",i[i.PlayerLost=4]="PlayerLost",N;var i})();const rt=i=>i.status!==Q.Miss&&i.status!==Q.Unknown;function it(i){const e=[];for(let t=0;t<10;t++)e.push(new Array(10));for(const t of i)e[t.x][t.y]=t;return e}function Oe(i,e){return BigInt(i+e*F)}let P0=(()=>{class i{constructor(t,n,a,o,s,c,d){this.wallet=t,this.gamePlayGql=n,this.gameProver=a,this.gameContract=o,this.gameStorage=s,this.route=c,this.router=d,this.TurnStatus=N,this.ShotStatus=Q,this.gameId$=this.route.paramMap.pipe((0,E.U)(l=>l.get("gameId")),(0,v.d)(1)),this.game$=this.gameId$.pipe((0,nt.w)(l=>this.gamePlayGql.watch({gameId:l},{pollInterval:1e3}).valueChanges),(0,E.U)(({data:l})=>l?.game),(0,Kt.h)(l=>!!l),(0,v.d)(1)),this.isHost$=(0,Y.a)([this.wallet.address$,this.game$]).pipe((0,E.U)(([l,f])=>f.startedBy.toLowerCase()===l?.toLowerCase()),(0,v.d)(1)),this.turnStatus$=(0,Y.a)([this.wallet.address$,this.game$,this.isHost$]).pipe((0,E.U)(([l,f,h])=>{switch(f.status){case q.Started:return N.WaitingForOpponent;case q.Joined:return f.turn%2==(h?0:1)?N.PlayerTurn:N.OpponentTurn;case q.Over:return f.wonBy.toLowerCase()===l?.toLowerCase()?N.PlayerWon:N.PlayerLost;default:throw new Error("Invalid game status!")}}),(0,v.d)(1)),this.isPlayerTurn$=this.turnStatus$.pipe((0,E.U)(l=>l===N.PlayerTurn),(0,v.d)(1)),this.playerBoard$=(0,Y.a)([this.gameId$,this.wallet.address$]).pipe((0,nt.w)(([l,f])=>this.gameStorage.getGameBoard(BigInt(l),f)),(0,v.d)(1)),this.playerShipOccupancyBoard$=this.playerBoard$.pipe((0,E.U)(l=>{const f=[];for(let h=0;h<F;h++)f.push(new Array(F).fill(void 0));if(!l)return f;for(let h=0;h<5;h++){const g=l.ships[h],A=Se[h].length,O=Number(g[0]),Pe=Number(g[1]),_e=0n===g[2],k0=(_e?O:Pe)+A-1;for(let we=_e?O:Pe;we<k0+1;we++)f[_e?we:O][_e?Pe:we]=Se[h]}return f})),this.playerFiringShot$=new ie.X(!1),this.playerShots$=(0,Y.a)([this.game$,this.isHost$]).pipe((0,E.U)(([l,f])=>l.shots?.filter(h=>h.turn%2==(f?0:1))||[]),(0,v.d)(1)),this.opponentShots$=(0,Y.a)([this.game$,this.isHost$]).pipe((0,E.U)(([l,f])=>l.shots?.filter(h=>h.turn%2==(f?1:0))||[]),(0,v.d)(1)),this.playerHitShots$=this.playerShots$.pipe((0,E.U)(l=>l?.filter(rt)),(0,v.d)(1)),this.opponentHitShots$=this.opponentShots$.pipe((0,E.U)(l=>l?.filter(rt)),(0,v.d)(1)),this.playerShotsBoard$=this.playerShots$.pipe((0,E.U)(it),(0,v.d)(1)),this.opponentShotsBoard$=this.opponentShots$.pipe((0,E.U)(it),(0,v.d)(1)),this.playerCellsLeft$=this.opponentHitShots$.pipe((0,E.U)(l=>17-l?.length),(0,v.d)(1)),this.opponentCellsLeft$=this.playerHitShots$.pipe((0,E.U)(l=>17-l?.length),(0,v.d)(1)),this.lastGameShot$=this.game$.pipe((0,E.U)(l=>l.shots&&l.shots.length>0?l.shots[l.shots.length-1]:void 0),(0,v.d)(1)),this.playerShotSelection=new Ne,this.playerCanFireShot$=(0,Y.a)([this.isPlayerTurn$,this.playerShotSelection.changed.asObservable()]).pipe((0,E.U)(([l,f])=>l&&f.source.hasValue())),this.columns=$e,this.rows=Ze}ngOnInit(){}fireShot(){var t=this;return(0,I.Z)(function*(){if(!(yield C(t.playerFiringShot$))){t.playerFiringShot$.next(!0);try{const a=yield C(t.game$).then(c=>0===c?.turn),o=yield C(t.gameId$).then(c=>BigInt(c)),s=t.playerShotSelection.selected[0];if(a)yield t.gameContract.playFirstTurn(o,s);else{const c=yield C(t.playerBoard$).then(h=>h),d=yield C(t.lastGameShot$).then(h=>h),l=Oe(d.x,d.y),f=yield t.gameProver.generateFireShotProof(c.ships,c.trapdoor,c.hash,l);yield t.gameContract.playTurn(o,l,s,f)}t.playerShotSelection.clear()}finally{t.playerFiringShot$.next(!1)}}})()}selectPlayerTurnShotLocation(t,n){this.playerShotSelection.toggle(Oe(t,n))}playerShotLocationIsSelected(t,n){return this.playerShotSelection.isSelected(Oe(t,n))}}return i.\u0275fac=function(t){return new(t||i)(r.Y36(ae.X),r.Y36(t0),r.Y36(Te),r.Y36(Ge),r.Y36(Ie),r.Y36($.gz),r.Y36($.F0))},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-game-play"]],decls:37,vars:27,consts:[[3,"ngSwitch"],["class","text-center",4,"ngSwitchCase"],[1,"d-flex","justify-content-between"],[1,"h5","mb-1"],[1,"h4"],[1,"text-end"],[1,"d-flex","justify-content-center"],[4,"ngIf"],["id","player-shots-board","class","flex-1 m-5",4,"ngIf"],[1,"text-center"],[1,"btn","btn-primary",3,"disabled","click"],[1,"position-fixed","bottom-0","end-0","p-3",2,"z-index","11"],["id","liveToast","role","alert","aria-live","assertive","aria-atomic","true",1,"toast"],[1,"toast-header"],[1,"me-auto"],[1,"toast-body"],["id","player-ships-board","class","flex-1 m-5",4,"ngIf"],["id","player-ships-board",1,"flex-1","m-5"],[4,"ngFor","ngForOf"],[3,"shot-miss","shot-hit",4,"ngIf"],["id","player-shots-board",1,"flex-1","m-5"],["class","shot-present",3,"shot-miss","shot-hit","ngSwitch",4,"ngIf","ngIfElse"],["noPlayerShotCell",""],[1,"shot-present",3,"ngSwitch"],[4,"ngSwitchCase"],[3,"click"]],template:function(t,n){1&t&&(r.ynx(0,0),r.ALo(1,"async"),r.YNc(2,s0,2,0,"h1",1),r.YNc(3,a0,2,0,"h1",1),r.YNc(4,o0,2,0,"h1",1),r.YNc(5,c0,2,0,"h1",1),r.YNc(6,l0,2,0,"h1",1),r.BQk(),r.TgZ(7,"div",2)(8,"div")(9,"p",3),r._uU(10,"Your Ship Cells Left"),r.qZA(),r.TgZ(11,"p",4),r._uU(12),r.ALo(13,"async"),r.qZA()(),r.TgZ(14,"div",5)(15,"p",3),r._uU(16,"Opponent Ship Cells Left"),r.qZA(),r.TgZ(17,"p",4),r._uU(18),r.ALo(19,"async"),r.qZA()()(),r.TgZ(20,"div",6),r.YNc(21,y0,3,3,"ng-container",7),r.ALo(22,"async"),r.YNc(23,O0,5,2,"table",8),r.ALo(24,"async"),r.qZA(),r.TgZ(25,"div",9)(26,"button",10),r.NdJ("click",function(){return n.fireShot()}),r.ALo(27,"async"),r._uU(28," Fire shot "),r.qZA()(),r.TgZ(29,"div",11)(30,"div",12),r.ALo(31,"async"),r.TgZ(32,"div",13)(33,"strong",14),r._uU(34,"Battleship3"),r.qZA()(),r.TgZ(35,"div",15),r._uU(36,"Firing shot..."),r.qZA()()()),2&t&&(r.Q6J("ngSwitch",r.lcZ(1,13,n.turnStatus$)),r.xp6(2),r.Q6J("ngSwitchCase",n.TurnStatus.WaitingForOpponent),r.xp6(1),r.Q6J("ngSwitchCase",n.TurnStatus.PlayerTurn),r.xp6(1),r.Q6J("ngSwitchCase",n.TurnStatus.OpponentTurn),r.xp6(1),r.Q6J("ngSwitchCase",n.TurnStatus.PlayerWon),r.xp6(1),r.Q6J("ngSwitchCase",n.TurnStatus.PlayerLost),r.xp6(6),r.Oqu(r.lcZ(13,15,n.playerCellsLeft$)),r.xp6(6),r.Oqu(r.lcZ(19,17,n.opponentCellsLeft$)),r.xp6(3),r.Q6J("ngIf",r.lcZ(22,19,n.playerShipOccupancyBoard$)),r.xp6(2),r.Q6J("ngIf",r.lcZ(24,21,n.playerShotsBoard$)),r.xp6(3),r.Q6J("disabled",!r.lcZ(27,23,n.playerCanFireShot$)),r.xp6(4),r.ekj("show",r.lcZ(31,25,n.playerFiringShot$)))},directives:[T.RF,T.n9,T.O5,T.sg],pipes:[T.Ov],styles:["th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{width:48px;height:48px;text-align:center}td[_ngcontent-%COMP%]{border:1px solid #1a1a1a}#player-ships-board[_ngcontent-%COMP%]   td.shot-miss[_ngcontent-%COMP%]{background-color:#eceeef}#player-ships-board[_ngcontent-%COMP%]   td.shot-hit[_ngcontent-%COMP%]{color:#f8f9fa;background-color:#d9534f}#player-shots-board[_ngcontent-%COMP%]   td.selected[_ngcontent-%COMP%]{background-color:#55595c}#player-shots-board[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:not(.selected):not(.shot-present):hover{background-color:#adb5bd}#player-shots-board[_ngcontent-%COMP%]   td.shot-miss[_ngcontent-%COMP%]{background-color:#eceeef}#player-shots-board[_ngcontent-%COMP%]   td.shot-hit[_ngcontent-%COMP%]{color:#f8f9fa;background-color:#4bbf73}"]}),i})();function B0(i,e){if(1&i&&(r.TgZ(0,"a",10)(1,"div",11),r._uU(2),r.qZA(),r.TgZ(3,"p",1),r._uU(4),r.qZA()()),2&i){const t=e.$implicit;r.MGl("routerLink","/games/",t.id,"/join"),r.xp6(2),r.hij("Game ",t.id,""),r.xp6(2),r.hij("Started by: ",t.startedBy,"")}}function N0(i,e){if(1&i&&(r.TgZ(0,"div",8),r.YNc(1,B0,5,3,"a",9),r.qZA()),2&i){const t=r.oxw().$implicit;r.xp6(1),r.Q6J("ngForOf",t)}}function $0(i,e){1&i&&(r.TgZ(0,"div",12)(1,"p"),r._uU(2,"No started games to show"),r.qZA()())}function Z0(i,e){if(1&i&&(r.ynx(0),r.YNc(1,N0,2,1,"div",6),r.YNc(2,$0,3,0,"ng-template",null,7,r.W1O),r.BQk()),2&i){const t=e.$implicit,n=r.MAs(3);r.xp6(1),r.Q6J("ngIf",t.length>0)("ngIfElse",n)}}function M0(i,e){1&i&&(r.TgZ(0,"div",12)(1,"div",13)(2,"span",14),r._uU(3,"Loading..."),r.qZA()()())}const z0=[{path:"",pathMatch:"full",component:(()=>{class i{constructor(t){this.startedGamesGql=t,this.startedGames$=this.startedGamesGql.watch(void 0,{pollInterval:6e4}).valueChanges.pipe((0,E.U)(({data:n})=>n.games))}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)(r.Y36(r0))},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-games-list"]],decls:13,vars:4,consts:[[1,"d-flex","justify-content-between","align-items-center","my-3"],[1,"m-0"],[1,"text-end","flex-grow-1"],["routerLink","/games/create",1,"btn","btn-primary","m-0"],[4,"ngIf","ngIfElse"],["loadingStartedGames",""],["class","list-group",4,"ngIf","ngIfElse"],["noStartedGames",""],[1,"list-group"],["class","list-group-item list-group-item-action",3,"routerLink",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action",3,"routerLink"],[1,"fw-bold"],[1,"text-center","my-5"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(t,n){if(1&t&&(r.TgZ(0,"div",0)(1,"div")(2,"h1"),r._uU(3,"Started Games"),r.qZA(),r.TgZ(4,"p",1),r._uU(5,"Click a game to join!"),r.qZA()(),r.TgZ(6,"div",2)(7,"a",3),r._uU(8,"Create game"),r.qZA()()(),r.YNc(9,Z0,4,2,"ng-container",4),r.ALo(10,"async"),r.YNc(11,M0,4,0,"ng-template",null,5,r.W1O)),2&t){const a=r.MAs(12);r.xp6(9),r.Q6J("ngIf",r.lcZ(10,2,n.startedGames$))("ngIfElse",a)}},directives:[$.yS,T.O5,T.sg],pipes:[T.Ov],styles:[""]}),i})()},{path:"create",component:Wt},{path:":gameId/join",component:Xt},{path:":gameId/play",component:P0}];let U0=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[$.Bz.forChild(z0)],$.Bz]}),i})(),F0=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[T.ez,$.Bz]]}),i})(),st=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[T.ez]]}),i})(),R0=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[T.ez,st]]}),i})(),L0=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[T.ez,st]]}),i})(),D0=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[T.ez]]}),i})(),j0=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[[T.ez,F0,R0,L0,D0,U0]]}),i})()}}]);